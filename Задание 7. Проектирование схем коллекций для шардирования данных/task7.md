# Задание 7. Проектирование схем коллекций для шардирования данных

Онлайн-магазин «Мобильный мир» сильно вырос, и теперь там можно купить не только аксессуары для смартфонов, но также электронику, аудио- и бытовую технику и другие категории товаров. Однако бэкенд сайта всё так же состоит из нескольких микросервисов.  

«Мобильный мир» хранит информацию о заказах, товарах и корзинах в трёх коллекциях в MongoDB.

**Коллекция orders включает заказы клиентов и содержит атрибуты:**
1. Уникальный идентификатор заказа;
2. Идентификатор клиента;
3. Дату и время оформления заказа;
4. Список заказанных товаров и их цену;
5. Статус заказа;
6. Общую сумму заказа;
7. Геозону заказа.

_Например, заказ пользователя из Москвы может включать товары из категорий «Электроника» и «Книги»._

Основные операции:
* Быстрое создание заказов с одновременным списанием остатков.
* Поиск истории заказов конкретного пользователя.
* Отображение статуса заказа.

**Коллекция products хранит сведения о товарах и включает такие атрибуты:**
* Уникальный идентификатор товара;
* Наименование;
* Категорию товара;
* Цену;
* Остаток товара в каждой геозоне;
* Дополнительные атрибуты (цвет, размер).

_Например, в Екатеринбурге есть в наличии 50 штук товара «Смартфон X», а в Калининграде — 30._

Основные операции:
* Частые обновления остатков при покупках.
* Поиск товаров по категориям и фильтрация по диапазону цен.
* Описание товара на странице продукта.

**Коллекция carts хранит данные о текущих корзинах (как гостевых, так и пользовательских) и включает атрибуты:**
* Уникальный идентификатор корзины (_id);
* Идентификатор пользователя (user_id) и session_id для гостей;
* Список товаров (items): массив документов { product_id, quantity };
* Статус корзины (status): "active" | "ordered" | "abandoned";
* Дату и время создания (created_at);
* Дату и время последнего обновления (updated_at);
* Время удаления (TTL) (expires_at) — для автоматической очистки старых корзин.

Основные операции:

* Создание корзины, когда заходит гость или новый пользователь.
* Получение текущей корзины по фильтру { session_id, status:"active" } или { user_id, status:"active" }.
* Добавление или замена товара в корзине.
* Удаление товара из корзины.
* Слияние гостевой корзины в пользовательскую, если пользователь залогинится:
  * прочитать гостевую { session_id, status:"active" };
  * добавить её items в корзину { user_id, status:"active" };
  * отметить гостевую как abandoned.
* Отметка корзины как заказанной.

## Что нужно сделать:
* Спроектируйте схемы коллекций products, orders и carts. Проанализируйте представленные атрибуты коллекций и выберите потенциальных кандидатов для шард-ключей.
* Выберите стратегию шардирования для каждой коллекции, которая обеспечит эффективное распределение данных по шардам.
* Укажите, почему выбранная стратегия и шард-ключ подходят под особенности коллекций и операций.

## На что будет смотреть ревьюер:
Архитектурный документ с описанием, схемами коллекций и примерами команд MongoDB. 