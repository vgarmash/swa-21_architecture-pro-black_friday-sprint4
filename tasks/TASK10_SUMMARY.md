# –ó–∞–¥–∞–Ω–∏–µ 10: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Cassandra

> üîÑ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Apache Cassandra –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–π –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ –±—ã—Å—Ç—Ä–æ–≥–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è  
> üè† [‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ README](../README.md) | üìñ [–ó–∞–¥–∞–Ω–∏–µ 9: –ß—Ç–µ–Ω–∏–µ —Å —Ä–µ–ø–ª–∏–∫](TASK9_SUMMARY.md)

---

## üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–ü—Ä–æ–±–ª–µ–º–∞ —Å MongoDB](#–ø—Ä–æ–±–ª–µ–º–∞-—Å-mongodb)
3. [–ü–æ—á–µ–º—É Cassandra](#–ø–æ—á–µ–º—É-cassandra)
4. [–ó–∞–¥–∞–Ω–∏–µ 10.1: –í—ã–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏](#–∑–∞–¥–∞–Ω–∏–µ-101-–≤—ã–±–æ—Ä-–¥–∞–Ω–Ω—ã—Ö-–¥–ª—è-–º–∏–≥—Ä–∞—Ü–∏–∏)
5. [–ó–∞–¥–∞–Ω–∏–µ 10.2: –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –≤ Cassandra](#–∑–∞–¥–∞–Ω–∏–µ-102-–º–æ–¥–µ–ª—å-–¥–∞–Ω–Ω—ã—Ö-–≤-cassandra)
6. [–ó–∞–¥–∞–Ω–∏–µ 10.3: –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è](#–∑–∞–¥–∞–Ω–∏–µ-103-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏-–∏-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è)
7. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ-—Ä–µ—à–µ–Ω–∏—è)
8. [–ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏](#–ø–ª–∞–Ω-–º–∏–≥—Ä–∞—Ü–∏–∏)
9. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–∞–ª–µ—Ä—Ç—ã)

---

## –í–≤–µ–¥–µ–Ω–∏–µ

### –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω "–ú–æ–±–∏–ª—å–Ω—ã–π –º–∏—Ä" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MongoDB —Å Range-Based Sharding. –í–æ –≤—Ä–µ–º—è "—á–µ—Ä–Ω–æ–π –ø—è—Ç–Ω–∏—Ü—ã" –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ **50,000 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫** –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

**–ü—Ä–æ–±–ª–µ–º—ã**:
- üî• **–í—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞** –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —à–∞—Ä–¥–æ–≤
- üî• **–ü–æ–ª–Ω–æ–µ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
- üî• **–ü—Ä–æ—Å–∞–¥–∫–∞ latency** –≤ –ø–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏
- üî• **–†–µ—Å—É—Ä—Å—ã —Ç—Ä–∞—Ç—è—Ç—Å—è –Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—é** –≤–º–µ—Å—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

**–¶–µ–ª—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Cassandra**:
- ‚úÖ –í—ã—Å–æ–∫–∞—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å (leaderless-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è)
- ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- ‚úÖ –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –Ω–∏–∑–∫–∞—è latency –¥–∞–∂–µ –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏

---

## –ü—Ä–æ–±–ª–µ–º–∞ —Å MongoDB

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤–æ –≤—Ä–µ–º—è "—á–µ—Ä–Ω–æ–π –ø—è—Ç–Ω–∏—Ü—ã"

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —à–∞—Ä–¥–∞

```
–î–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (2 —à–∞—Ä–¥–∞):
Shard 1: 50% –¥–∞–Ω–Ω—ã—Ö (5TB)
Shard 2: 50% –¥–∞–Ω–Ω—ã—Ö (5TB)

–î–æ–±–∞–≤–ª—è–µ–º Shard 3...

MongoDB –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É:
Shard 1: 50% ‚Üí 33% (–ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å 1.7TB)
Shard 2: 50% ‚Üí 33% (–ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å 1.7TB)
Shard 3: 0% ‚Üí 33% (–ø–æ–ª—É—á–∏—Ç—å 3.4TB)

–ü—Ä–æ–±–ª–µ–º–∞:
- –ú–∏–≥—Ä–∞—Ü–∏—è 3.4TB –∑–∞–Ω–∏–º–∞–µ—Ç –ß–ê–°–´
- –í —ç—Ç–æ –≤—Ä–µ–º—è latency —Ä–∞—Å—Ç–µ—Ç —Å 50ms –¥–æ 500ms+
- CPU –Ω–æ–¥ –Ω–∞ 90%+ –∏–∑-–∑–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–π —Å–∞–π—Ç
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: "–ì–æ—Ä—è—á–∏–π" —à–∞—Ä–¥

```
Range-Based Sharding –ø–æ category:

Shard 1 (A-M): books, electronics, etc.
  - electronics = 70% –∑–∞–ø—Ä–æ—Å–æ–≤
  - –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω üî•

Shard 2 (N-Z): phones, toys, etc.
  - –ù–µ–¥–æ–∑–∞–≥—Ä—É–∂–µ–Ω ‚úÖ

–†–µ—à–µ–Ω–∏–µ: Split chunk "electronics"
–ù–æ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è –∏ —Ä–µ—Å—É—Ä—Å—ã
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è MongoDB –¥–ª—è high-write workloads

| –ü—Ä–æ–±–ª–µ–º–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –í–ª–∏—è–Ω–∏–µ |
|----------|----------|---------|
| **Balancer overhead** | –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ chunks –º–µ–∂–¥—É —à–∞—Ä–¥–∞–º–∏ | Latency +300-500ms |
| **Single Primary** | –í—Å–µ –∑–∞–ø–∏—Å–∏ –∏–¥—É—Ç –Ω–∞ Primary –Ω–æ–¥—É replica set | –£–∑–∫–æ–µ –º–µ—Å—Ç–æ –¥–ª—è writes |
| **Oplog lag** | –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ Secondary –æ—Ç—Å—Ç–∞—é—Ç | Eventual consistency —Å –±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π |
| **Range-based chunks** | –ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π | "–ì–æ—Ä—è—á–∏–µ" —à–∞—Ä–¥—ã |
| **Scatter-gather queries** | –ó–∞–ø—Ä–æ—Å—ã –±–µ–∑ shard key –∏–¥—É—Ç –Ω–∞ –≤—Å–µ —à–∞—Ä–¥—ã | –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã |

---

## –ü–æ—á–µ–º—É Cassandra

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –Ω–∞—à–µ–≥–æ —Å–ª—É—á–∞—è

#### 1. Leaderless Replication

**MongoDB**:
```
Replica Set:
  Primary (writes) ‚Üí –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∑–¥–µ—Å—å üî•
  Secondary 1 (reads)
  Secondary 2 (reads)

–ü—Ä–æ–±–ª–µ–º–∞: Primary - —É–∑–∫–æ–µ –º–µ—Å—Ç–æ
```

**Cassandra**:
```
–í—Å–µ –Ω–æ–¥—ã —Ä–∞–≤–Ω—ã:
  Node 1 (reads + writes) ‚úÖ
  Node 2 (reads + writes) ‚úÖ
  Node 3 (reads + writes) ‚úÖ

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: –ù–µ—Ç —É–∑–∫–æ–≥–æ –º–µ—Å—Ç–∞
```

#### 2. Consistent Hashing (–Ω–µ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞)

**MongoDB (Range Sharding)**:
```
–î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —à–∞—Ä–¥:
‚Üí –ü–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –í–°–ï–• –¥–∞–Ω–Ω—ã—Ö
‚Üí 3.4TB –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å
‚Üí –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã
```

**Cassandra (Consistent Hashing)**:
```
–î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –Ω–æ–¥—É:
‚Üí –¢–æ–ª—å–∫–æ 1/N –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è
‚Üí –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ 4-–π –Ω–æ–¥—ã: —Ç–æ–ª—å–∫–æ 25% –¥–∞–Ω–Ω—ã—Ö
‚Üí –ú–∏–Ω—É—Ç—ã —Ä–∞–±–æ—Ç—ã
‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –Ω–µ–∑–∞–º–µ—Ç–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

**–ü—Ä–∏–º–µ—Ä**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ 4-–π –Ω–æ–¥—ã –≤ Cassandra
```
–ë—ã–ª–æ (3 –Ω–æ–¥—ã):
Node 1: 33% –¥–∞–Ω–Ω—ã—Ö
Node 2: 33% –¥–∞–Ω–Ω—ã—Ö
Node 3: 33% –¥–∞–Ω–Ω—ã—Ö

–î–æ–±–∞–≤–∏–ª–∏ Node 4:
Node 1: 33% ‚Üí 25% (–æ—Ç–¥–∞–ª 8%)
Node 2: 33% ‚Üí 25% (–æ—Ç–¥–∞–ª 8%)
Node 3: 33% ‚Üí 25% (–æ—Ç–¥–∞–ª 8%)
Node 4: 0% ‚Üí 25% (–ø–æ–ª—É—á–∏–ª 25% = –ø–æ 8% –æ—Ç –∫–∞–∂–¥–æ–π)

–ü–µ—Ä–µ–º–µ—â–µ–Ω–æ: –¢–û–õ–¨–ö–û 25% –¥–∞–Ω–Ω—ã—Ö (–≤–º–µ—Å—Ç–æ 100% –≤ MongoDB)
```

#### 3. Write-Optimized (LSM-tree)

**MongoDB (B-tree)**:
- Random writes ‚Üí –º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏–Ω–¥–µ–∫—Å—ã —Å—Ä–∞–∑—É
- Latency –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

**Cassandra (LSM-tree)**:
- Sequential writes ‚Üí –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ
- Append-only (memtable ‚Üí SSTable)
- Latency —Å—Ç–∞–±–∏–ª—å–Ω–∞ –¥–∞–∂–µ –ø—Ä–∏ 50k writes/sec

#### 4. Tunable Consistency

**MongoDB**:
- `readConcern: "majority"` –∏–ª–∏ `"local"`
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏

**Cassandra**:
- –ì–∏–±–∫–∏–µ —É—Ä–æ–≤–Ω–∏: ONE, QUORUM, ALL
- –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ö–æ–º–ø—Ä–æ–º–∏—Å—Å latency vs consistency

#### 5. Multi-Datacenter Replication

**MongoDB**:
- –ù—É–∂–Ω—ã zone sharding + —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- Latency –º–µ–∂–¥—É DC –≤–ª–∏—è–µ—Ç –Ω–∞ Primary

**Cassandra**:
- –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ multi-DC
- `NetworkTopologyStrategy`
- –õ–æ–∫–∞–ª—å–Ω—ã–π –∫–≤–æ—Ä—É–º –¥–ª—è latency

---

## –ó–∞–¥–∞–Ω–∏–µ 10.1: –í—ã–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏

### –ê–Ω–∞–ª–∏–∑ —Å—É—â–Ω–æ—Å—Ç–µ–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞

| –°—É—â–Ω–æ—Å—Ç—å | –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | MongoDB | Cassandra | –†–µ—à–µ–Ω–∏–µ |
|----------|---------------|---------|-----------|---------|
| **products** | ‚Ä¢ Read-heavy (95% reads)<br/>‚Ä¢ –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤<br/>‚Ä¢ –ù—É–∂–Ω—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | ‚úÖ ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏<br/>$inc –¥–ª—è –æ—Å—Ç–∞—Ç–∫–æ–≤<br/>Range sharding OK | ‚ùå –ù–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π<br/>Eventual consistency | **–û–°–¢–ê–í–ò–¢–¨ –≤ MongoDB** |
| **orders (active)** | ‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ + —Å–ø–∏—Å–∞–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤<br/>‚Ä¢ –ù—É–∂–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å<br/>‚Ä¢ –ö—Ä–∏—Ç–∏—á–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | ‚úÖ ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏<br/>Multi-document<br/>Strong consistency | ‚ùå –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π<br/>–†–∏—Å–∫ overselling | **–û–°–¢–ê–í–ò–¢–¨ –≤ MongoDB** |
| **order_history** | ‚Ä¢ Read-only (–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ)<br/>‚Ä¢ Append-only<br/>‚Ä¢ 100M+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤<br/>‚Ä¢ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ | ‚ö†Ô∏è –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –º–µ–¥–ª–µ–Ω–Ω–∞—è<br/>Primary bottleneck | ‚úÖ Write-optimized<br/>Time-series<br/>Leaderless | **–ú–ò–ì–†–ò–†–û–í–ê–¢–¨ –≤ Cassandra** |
| **carts** | ‚Ä¢ Very write-heavy (40% writes)<br/>‚Ä¢ –ö–æ—Ä–æ—Ç–∫–∞—è –∂–∏–∑–Ω—å (TTL)<br/>‚Ä¢ Eventual consistency OK | ‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Primary<br/>Oplog bloat | ‚úÖ TTL –≤—Å—Ç—Ä–æ–µ–Ω<br/>–ë—ã—Å—Ç—Ä—ã–µ writes | **–ú–ò–ì–†–ò–†–û–í–ê–¢–¨ –≤ Cassandra** |
| **sessions** | ‚Ä¢ Very write-heavy<br/>‚Ä¢ TTL (30 –º–∏–Ω—É—Ç)<br/>‚Ä¢ –í—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ | ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç<br/>Oplog overhead | ‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ<br/>In-memory + TTL | **–ú–ò–ì–†–ò–†–û–í–ê–¢–¨ –≤ Cassandra** |
| **events/logs** | ‚Ä¢ Write-only<br/>‚Ä¢ Time-series<br/>‚Ä¢ –û–≥—Ä–æ–º–Ω—ã–π –æ–±—ä–µ–º | ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç<br/>–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –¥–æ—Ä–æ–≥–∞—è | ‚úÖ Time-series<br/>–ö–æ–º–ø–∞–∫—Ü–∏—è | **–ú–ò–ì–†–ò–†–û–í–ê–¢–¨ –≤ Cassandra** |
| **users** | ‚Ä¢ Read-heavy<br/>‚Ä¢ –†–µ–¥–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è<br/>‚Ä¢ –ù—É–∂–Ω—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | ‚úÖ –•–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç<br/>ACID OK | ‚ùå –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | **–û–°–¢–ê–í–ò–¢–¨ –≤ MongoDB** |

### –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ

#### ‚úÖ –ú–ò–ì–†–ò–†–£–ï–ú –í CASSANDRA (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ write-heavy –¥–∞–Ω–Ω—ã–µ)

**1. Order History (–ò—Å—Ç–æ—Ä–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤)**
- **–ü–æ—á–µ–º—É**: 
  - Read-only: –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –Ω–µ –º–µ–Ω—è—é—Ç—Å—è (—Å—Ç–∞—Ç—É—Å final)
  - Append-only: –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
  - –û–≥—Ä–æ–º–Ω—ã–π –æ–±—ä–µ–º: 100M+ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
  - –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏
  
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Cassandra**:
  - ‚úÖ Time-series –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (order_date)
  - ‚úÖ –ö–æ–º–ø–∞–∫—Ü–∏—è –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
  - ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - ‚úÖ –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ user_id
  
- **–ß—Ç–æ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ MongoDB**:
  - ‚ö†Ô∏è **–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã** (pending, processing) - –Ω—É–∂–Ω—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å products.stock

**2. Active Carts (–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã)**
- **–ü–æ—á–µ–º—É**:
  - Very write-heavy: –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
  - –ö–æ—Ä–æ—Ç–∫–∞—è –∂–∏–∑–Ω—å: TTL 30 –¥–Ω–µ–π
  - –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è UX (–∑–∞–¥–µ—Ä–∂–∫–∞ = –ø–æ—Ç–µ—Ä—è –ø—Ä–æ–¥–∞–∂)
  
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Cassandra**:
  - ‚úÖ –ë—ã—Å—Ç—Ä—ã–µ writes ‚Üí –ª—É—á—à–∏–π UX
  - ‚úÖ TTL –≤—Å—Ç—Ä–æ–µ–Ω ‚Üí –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞
  - ‚úÖ Session affinity (partition key = user_id)

**3. User Sessions (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–µ—Å—Å–∏–∏)**
- **–ü–æ—á–µ–º—É**:
  - Very write-heavy: –∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - TTL: 30 –º–∏–Ω—É—Ç
  - –í—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞: 100,000 —Å–µ—Å—Å–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
  
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Cassandra**:
  - ‚úÖ –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–µ writes
  - ‚úÖ TTL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  - ‚úÖ In-memory —Ç–∞–±–ª–∏—Ü—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**4. Events & Clickstream (–°–æ–±—ã—Ç–∏—è, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)**
- **–ü–æ—á–µ–º—É**:
  - Write-only: —Ç–æ–ª—å–∫–æ –≤—Å—Ç–∞–≤–∫–∞, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
  - Time-series: —Å–æ–±—ã—Ç–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
  - –û–≥—Ä–æ–º–Ω—ã–π –æ–±—ä–µ–º: –º–∏–ª–ª–∏–æ–Ω—ã —Å–æ–±—ã—Ç–∏–π/–¥–µ–Ω—å
  
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Cassandra**:
  - ‚úÖ Time-series workload
  - ‚úÖ –ö–æ–º–ø–∞–∫—Ü–∏—è (—ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞)
  - ‚úÖ –ù–µ –Ω—É–∂–Ω–∞ ACID

#### üîÑ –û–°–¢–ê–í–õ–Ø–ï–ú –í MONGODB (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

**1. Active Orders (–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã) + Products (–¢–æ–≤–∞—Ä—ã —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏)**
- **–ü–æ—á–µ–º—É –æ—Å—Ç–∞–µ—Ç—Å—è**:
  - üî¥ **–ö–†–ò–¢–ò–ß–ù–û**: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ + —Å–ø–∏—Å–∞–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ = –æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
  - –ù—É–∂–Ω–∞ –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å: –µ—Å–ª–∏ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–∞ ‚Üí –∑–∞–∫–∞–∑ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è
  - –†–∏—Å–∫ overselling –ø—Ä–∏ eventual consistency
  - ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–µ–∂–¥—É orders –∏ products.stock
  
- **–ü—Ä–∏–º–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**:
  ```javascript
  // MongoDB Transaction
  session.startTransaction();
  try {
    // 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —Å–ø–∏—Å–∞—Ç—å –æ—Å—Ç–∞—Ç–∫–∏
    const product = await db.products.findOneAndUpdate(
      { _id: productId, "stock.moscow": { $gte: quantity } },
      { $inc: { "stock.moscow": -quantity } },
      { session }
    );
    
    if (!product) throw new Error("Out of stock");
    
    // 2. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
    await db.orders.insertOne(orderData, { session });
    
    await session.commitTransaction();
  } catch (error) {
    await session.abortTransaction();
    throw error;
  }
  ```
  
- **–ß—Ç–æ –º–∏–≥—Ä–∏—Ä—É–µ—Ç –≤ Cassandra**:
  - –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ (status: 'delivered') ‚Üí –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ order_history
  
**2. Users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)**
- **–ü–æ—á–µ–º—É –æ—Å—Ç–∞–µ—Ç—Å—è**:
  - –ù—É–∂–Ω—ã ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è, –±–∞–ª–∞–Ω—Å–∞)
  - –°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–ø–æ–∏—Å–∫ –ø–æ email, —Ç–µ–ª–µ—Ñ–æ–Ω—É)
  - –†–µ–¥–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     Load Balancer / API Gateway              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                ‚îÇ                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ   MongoDB    ‚îÇ           ‚îÇ  Cassandra   ‚îÇ
        ‚îÇ   Cluster    ‚îÇ           ‚îÇ   Cluster    ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                ‚îÇ         ‚îÇ                      ‚îÇ
    Transactional    ACID         Write-Heavy        Time-Series
        Data         Required        Data               Data
        ‚îÇ                ‚îÇ           ‚îÇ                    ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ users   ‚îÇ    ‚îÇ products  ‚îÇ  ‚îÇorder_history‚îÇ   ‚îÇ   events   ‚îÇ
    ‚îÇ         ‚îÇ    ‚îÇ  (stock)  ‚îÇ  ‚îÇ   carts     ‚îÇ   ‚îÇ clickstream‚îÇ
    ‚îÇ         ‚îÇ    ‚îÇ           ‚îÇ  ‚îÇ  sessions   ‚îÇ   ‚îÇ            ‚îÇ
    ‚îÇ         ‚îÇ    ‚îÇ orders    ‚îÇ  ‚îÇ             ‚îÇ   ‚îÇ            ‚îÇ
    ‚îÇ         ‚îÇ    ‚îÇ (active)  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚îÇ –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                        ‚ñº
                   order_history
                   (Cassandra)
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã**:
- üî¥ **Active Orders + Products** –≤ MongoDB (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤)
- ‚úÖ **Order History** –≤ Cassandra (–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã, read-only)
- ‚úÖ **Carts, Sessions, Events** –≤ Cassandra (write-heavy, eventual consistency OK)

---

## –ó–∞–¥–∞–Ω–∏–µ 10.2: –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –≤ Cassandra

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Cassandra

**–û—Ç–ª–∏—á–∏—è –æ—Ç MongoDB**:

| –ê—Å–ø–µ–∫—Ç | MongoDB | Cassandra |
|--------|---------|-----------|
| **–ü–æ–¥—Ö–æ–¥** | Schema-first | Query-first |
| **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è** | –ú–æ–∂–Ω–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å |
| **JOIN** | `$lookup` | –ù–µ—Ç (–¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è) |
| **–ò–Ω–¥–µ–∫—Å—ã** | –í—Ç–æ—Ä–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã | –¢–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á–∞–º |
| **–ì–∏–±–∫–æ—Å—Ç—å** | –ì–∏–±–∫–∞—è —Å—Ö–µ–º–∞ | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ |

**–ü—Ä–∞–≤–∏–ª–æ Cassandra**: 
> "–û–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ = –æ–¥–∏–Ω –ø–∞—Ç—Ç–µ—Ä–Ω –∑–∞–ø—Ä–æ—Å–∞"

### 1. Order History (–ò—Å—Ç–æ—Ä–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤)

**‚ö†Ô∏è –í–ê–ñ–ù–û**: –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã (pending, processing) –æ—Å—Ç–∞—é—Ç—Å—è –≤ MongoDB –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏!

#### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤

1. **Q1**: –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ)
2. **Q2**: –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ –ø–æ ID
3. **Q3**: –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
4. **Q4**: –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É (–¥–ª—è –æ—Ç—á–µ—Ç–æ–≤)

#### –¢–∞–±–ª–∏—Ü–∞ 1: `order_history_by_user` (Q1)

**–¶–µ–ª—å**: –ò—Å—Ç–æ—Ä–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Partition Key**: `user_id` - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –Ω–æ–¥–∞–º  
**Clustering Key**: `order_date DESC, order_id` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤–Ω—É—Ç—Ä–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏

```sql
CREATE TABLE order_history_by_user (
    user_id UUID,                    -- Partition key
    order_date TIMESTAMP,            -- Clustering key (desc)
    order_id UUID,                   -- Clustering key
    
    -- –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∏–∑ MongoDB –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞)
    status TEXT,                     -- 'delivered', 'cancelled', 'returned'
    total_amount DECIMAL,
    currency TEXT,
    
    items LIST<FROZEN<order_item>>, -- –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
    
    shipping_address FROZEN<address>,
    billing_address FROZEN<address>,
    
    payment_method TEXT,
    payment_id TEXT,
    
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    
    PRIMARY KEY ((user_id), order_date, order_id)
) WITH CLUSTERING ORDER BY (order_date DESC, order_id ASC)
  AND compaction = {
    'class': 'TimeWindowCompactionStrategy',
    'compaction_window_unit': 'DAYS',
    'compaction_window_size': 1
  }
  AND gc_grace_seconds = 86400;  -- 1 –¥–µ–Ω—å (–±—ã—Å—Ç—Ä–∞—è –∫–æ–º–ø–∞–∫—Ü–∏—è)

-- UDT –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
CREATE TYPE order_item (
    product_id UUID,
    product_name TEXT,
    sku TEXT,
    quantity INT,
    price DECIMAL,
    currency TEXT
);

-- UDT –¥–ª—è –∞–¥—Ä–µ—Å–∞
CREATE TYPE address (
    street TEXT,
    city TEXT,
    state TEXT,
    country TEXT,
    postal_code TEXT
);
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ Partition Key**:
- ‚úÖ `user_id` - –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã)
- ‚úÖ –ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å: ~10M –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí —Ö–æ—Ä–æ—à–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- ‚úÖ –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–Ω–∞ –ø–∞—Ä—Ç–∏—Ü–∏—è ‚Üí –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø
- ‚ö†Ô∏è –†–∏—Å–∫: VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å 10,000 –∑–∞–∫–∞–∑–æ–≤ ‚Üí –±–æ–ª—å—à–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è
  - **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å bucketing –ø–æ –≥–æ–¥—É/–º–µ—Å—è—Ü—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ Clustering Key**:
- ‚úÖ `order_date DESC` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º
- ‚úÖ `order_id` - —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å, –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤ –≤ –æ–¥–Ω—É —Å–µ–∫—É–Ω–¥—É
- ‚úÖ Range scan: "–∑–∞–∫–∞–∑—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü" - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

**–ó–∞–ø—Ä–æ—Å—ã**:
```sql
-- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10)
SELECT * FROM order_history_by_user
WHERE user_id = 123e4567-e89b-12d3-a456-426614174000
LIMIT 10;

-- –ó–∞–∫–∞–∑—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
SELECT * FROM order_history_by_user
WHERE user_id = 123e4567-e89b-12d3-a456-426614174000
  AND order_date >= '2025-11-01'
  AND order_date < '2025-12-01';
```

#### –¢–∞–±–ª–∏—Ü–∞ 2: `order_history_by_id` (Q2)

**–¶–µ–ª—å**: –ë—ã—Å—Ç—Ä—ã–π lookup –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ –ø–æ ID (–¥–ª—è –¥–µ—Ç–∞–ª–µ–π, –≤–æ–∑–≤—Ä–∞—Ç–æ–≤)

**Partition Key**: `order_id`

```sql
CREATE TABLE order_history_by_id (
    order_id UUID,                   -- Partition key
    user_id UUID,
    order_date TIMESTAMP,
    
    -- –¢–µ –∂–µ –¥–∞–Ω–Ω—ã–µ —á—Ç–æ –∏ –≤ order_history_by_user
    status TEXT,
    total_amount DECIMAL,
    currency TEXT,
    items LIST<FROZEN<order_item>>,
    shipping_address FROZEN<address>,
    billing_address FROZEN<address>,
    payment_method TEXT,
    payment_id TEXT,
    created_at TIMESTAMP,
    completed_at TIMESTAMP,          -- –ö–æ–≥–¥–∞ –∑–∞–∫–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω
    
    PRIMARY KEY (order_id)
);
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- ‚úÖ –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: –¥—É–±–ª–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ lookup
- ‚úÖ `order_id` - —É–Ω–∏–∫–∞–ª–µ–Ω ‚Üí —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- ‚úÖ –û–¥–Ω–∞ –ø–∞—Ä—Ç–∏—Ü–∏—è = –æ–¥–∏–Ω –∑–∞–∫–∞–∑ ‚Üí –±—ã—Å—Ç—Ä–æ

**–ó–∞–ø—Ä–æ—Å**:
```sql
SELECT * FROM order_history_by_id
WHERE order_id = 123e4567-e89b-12d3-a456-426614174000;
```

#### –¢–∞–±–ª–∏—Ü–∞ 3: `order_history_by_date_and_status` (Q3, Q4)

**–¶–µ–ª—å**: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞, –æ—Ç—á–µ—Ç—ã, –∞–¥–º–∏–Ω–∫–∞

**Partition Key**: `order_date_bucket, status` (composite)  
**Clustering Key**: `order_date DESC, order_id`

```sql
CREATE TABLE order_history_by_date_and_status (
    order_date_bucket TEXT,          -- Partition key: '2025-12' (–≥–æ–¥-–º–µ—Å—è—Ü)
    status TEXT,                     -- Partition key
    order_date TIMESTAMP,            -- Clustering key
    order_id UUID,                   -- Clustering key
    
    user_id UUID,
    total_amount DECIMAL,
    currency TEXT,
    
    -- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    
    PRIMARY KEY ((order_date_bucket, status), order_date, order_id)
) WITH CLUSTERING ORDER BY (order_date DESC, order_id ASC);
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ Partition Key**:
- ‚úÖ `order_date_bucket` - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –º–µ—Å—è—Ü—É
  - –ò–∑–±–µ–≥–∞–µ–º –æ–≥—Ä–æ–º–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π (–≤—Å–µ –∑–∞–∫–∞–∑—ã –≤ –æ–¥–Ω–æ–π)
  - 1 –º–µ—Å—è—Ü ‚âà 2-3M –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ ‚Üí –ø—Ä–∏–µ–º–ª–µ–º–æ
- ‚úÖ `status` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –¥–µ–ª–µ–Ω–∏–µ
  - 'delivered', 'cancelled', 'returned' - 3 –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–∞ –º–µ—Å—è—Ü
  - –ò—Ç–æ–≥–æ: 12 –º–µ—Å—è—Ü–µ–≤ √ó 3 —Å—Ç–∞—Ç—É—Å–∞ = 36 –ø–∞—Ä—Ç–∏—Ü–∏–π –≤ –≥–æ–¥

**–ó–∞–ø—Ä–æ—Å—ã**:
```sql
-- –í—Å–µ delivered –∑–∞–∫–∞–∑—ã –∑–∞ –¥–µ–∫–∞–±—Ä—å 2025
SELECT * FROM order_history_by_date_and_status
WHERE order_date_bucket = '2025-12'
  AND status = 'delivered';

-- –í–æ–∑–≤—Ä–∞—Ç—ã –∑–∞ –ø–µ—Ä–∏–æ–¥
SELECT * FROM order_history_by_date_and_status
WHERE order_date_bucket = '2025-12'
  AND status = 'returned'
  AND order_date >= '2025-12-15'
  AND order_date < '2025-12-20';
```

### 2. Active Carts (–ö–æ—Ä–∑–∏–Ω—ã)

#### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤

1. **Q1**: –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **Q2**: –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –ø–æ session_id (–≥–æ—Å—Ç—å)
3. **Q3**: Abandoned carts (–¥–ª—è –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞)

#### –¢–∞–±–ª–∏—Ü–∞ 1: `carts_by_user` (Q1, Q2)

**Partition Key**: `user_session_key` (user_id –∏–ª–∏ session_id)  
**Clustering Key**: `status, updated_at DESC`

```sql
CREATE TABLE carts_by_user (
    user_session_key TEXT,           -- Partition key: user_id –∏–ª–∏ session_id
    status TEXT,                     -- Clustering key: 'active', 'ordered', 'abandoned'
    updated_at TIMESTAMP,            -- Clustering key
    cart_id UUID,
    
    items LIST<FROZEN<cart_item>>,
    
    created_at TIMESTAMP,
    expires_at TIMESTAMP,            -- TTL
    
    -- –î–ª—è —Å–ª–∏—è–Ω–∏—è –∫–æ—Ä–∑–∏–Ω
    user_id UUID,
    session_id TEXT,
    
    PRIMARY KEY (user_session_key, status, updated_at)
) WITH CLUSTERING ORDER BY (status ASC, updated_at DESC)
  AND default_time_to_live = 2592000;  -- 30 –¥–Ω–µ–π TTL

CREATE TYPE cart_item (
    product_id UUID,
    product_name TEXT,
    sku TEXT,
    quantity INT,
    price DECIMAL,
    added_at TIMESTAMP
);
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- ‚úÖ `user_session_key` - —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á –¥–ª—è user –∏ guest
- ‚úÖ TTL –≤—Å—Ç—Ä–æ–µ–Ω - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ—Ä–∑–∏–Ω
- ‚úÖ `status` –≤ clustering key - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ active/abandoned
- ‚úÖ `updated_at DESC` - —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–≤—ã–º–∏

**–ó–∞–ø—Ä–æ—Å—ã**:
```sql
-- –ê–∫—Ç–∏–≤–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT * FROM carts_by_user
WHERE user_session_key = 'user:123e4567-e89b-12d3-a456-426614174000'
  AND status = 'active'
LIMIT 1;

-- –ê–∫—Ç–∏–≤–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ –≥–æ—Å—Ç—è
SELECT * FROM carts_by_user
WHERE user_session_key = 'session:abc123def456'
  AND status = 'active'
LIMIT 1;
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã**:
```sql
-- –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä (UPDATE = INSERT –≤ Cassandra)
INSERT INTO carts_by_user (
    user_session_key, status, updated_at, cart_id,
    items, created_at, user_id
) VALUES (
    'user:123e4567-e89b-12d3-a456-426614174000',
    'active',
    toTimestamp(now()),
    uuid(),
    [{product_id: uuid(), product_name: 'iPhone 15', quantity: 1, ...}],
    toTimestamp(now()),
    123e4567-e89b-12d3-a456-426614174000
);
```

#### –¢–∞–±–ª–∏—Ü–∞ 2: `abandoned_carts` (Q3)

**–¶–µ–ª—å**: –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥, –≤–æ–∑–≤—Ä–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**Partition Key**: `abandoned_date_bucket`  
**Clustering Key**: `abandoned_at DESC, user_session_key`

```sql
CREATE TABLE abandoned_carts (
    abandoned_date_bucket TEXT,      -- Partition key: '2025-12-15' (–¥–µ–Ω—å)
    abandoned_at TIMESTAMP,          -- Clustering key
    user_session_key TEXT,           -- Clustering key
    
    cart_id UUID,
    user_id UUID,
    session_id TEXT,
    
    items LIST<FROZEN<cart_item>>,
    total_value DECIMAL,
    
    PRIMARY KEY (abandoned_date_bucket, abandoned_at, user_session_key)
) WITH CLUSTERING ORDER BY (abandoned_at DESC, user_session_key ASC);
```

**–ó–∞–ø—Ä–æ—Å**:
```sql
-- Abandoned carts –∑–∞ —Å–µ–≥–æ–¥–Ω—è
SELECT * FROM abandoned_carts
WHERE abandoned_date_bucket = '2025-12-15';
```

### 3. User Sessions (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–µ—Å—Å–∏–∏)

#### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤

1. **Q1**: –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Å—Å–∏—é –ø–æ session_id
2. **Q2**: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –¢–∞–±–ª–∏—Ü–∞: `user_sessions`

**Partition Key**: `session_id`

```sql
CREATE TABLE user_sessions (
    session_id TEXT,                 -- Partition key
    user_id UUID,
    
    -- –î–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
    ip_address TEXT,
    user_agent TEXT,
    device_type TEXT,               -- 'mobile', 'desktop', 'tablet'
    
    -- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    created_at TIMESTAMP,
    last_activity_at TIMESTAMP,
    expires_at TIMESTAMP,
    
    -- –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
    current_page TEXT,
    referrer TEXT,
    utm_source TEXT,
    utm_medium TEXT,
    utm_campaign TEXT,
    
    PRIMARY KEY (session_id)
) WITH default_time_to_live = 1800;  -- 30 –º–∏–Ω—É—Ç TTL
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- ‚úÖ `session_id` - —É–Ω–∏–∫–∞–ª–µ–Ω –∏ —Å–ª—É—á–∞–µ–Ω ‚Üí —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- ‚úÖ TTL 30 –º–∏–Ω—É—Ç - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è (–æ–¥–Ω–∞ —Å–µ—Å—Å–∏—è = –æ–¥–Ω–∞ –ø–∞—Ä—Ç–∏—Ü–∏—è)

**–ó–∞–ø—Ä–æ—Å**:
```sql
SELECT * FROM user_sessions
WHERE session_id = 'abc123def456';
```

### 4. Events & Clickstream (–°–æ–±—ã—Ç–∏—è)

#### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤

1. **Q1**: –í—Å–µ —Å–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ –ø–µ—Ä–∏–æ–¥
2. **Q2**: –í—Å–µ —Å–æ–±—ã—Ç–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
3. **Q3**: Clickstream –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏

#### –¢–∞–±–ª–∏—Ü–∞ 1: `events_by_user` (Q1)

**Partition Key**: `user_id, event_date_bucket`  
**Clustering Key**: `event_timestamp DESC, event_id`

```sql
CREATE TABLE events_by_user (
    user_id UUID,                    -- Partition key
    event_date_bucket TEXT,          -- Partition key: '2025-12-15' (–¥–µ–Ω—å)
    event_timestamp TIMESTAMP,       -- Clustering key
    event_id TIMEUUID,               -- Clustering key (—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å)
    
    event_type TEXT,                 -- 'page_view', 'click', 'add_to_cart', etc.
    session_id TEXT,
    
    -- Event data (JSON –∏–ª–∏ UDT)
    page_url TEXT,
    referrer TEXT,
    product_id UUID,
    action TEXT,
    
    -- Device/Browser info
    ip_address TEXT,
    user_agent TEXT,
    
    PRIMARY KEY ((user_id, event_date_bucket), event_timestamp, event_id)
) WITH CLUSTERING ORDER BY (event_timestamp DESC, event_id DESC)
  AND compaction = {
    'class': 'TimeWindowCompactionStrategy',
    'compaction_window_unit': 'DAYS',
    'compaction_window_size': 1
  }
  AND gc_grace_seconds = 86400;

```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- ‚úÖ `(user_id, event_date_bucket)` - –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π partition key
  - –ò–∑–±–µ–≥–∞–µ–º –æ–≥—Ä–æ–º–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π (–≤—Å–µ —Å–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  - 1 –¥–µ–Ω—å √ó 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚âà 100-500 —Å–æ–±—ã—Ç–∏–π
- ‚úÖ `TIMEUUID` –¥–ª—è event_id - —É–ø–æ—Ä—è–¥–æ—á–µ–Ω –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ Time-series compaction - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤

**–ó–∞–ø—Ä–æ—Å**:
```sql
-- –°–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è
SELECT * FROM events_by_user
WHERE user_id = 123e4567-e89b-12d3-a456-426614174000
  AND event_date_bucket = '2025-12-15';

-- –°–æ–±—ã—Ç–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
SELECT * FROM events_by_user
WHERE user_id = 123e4567-e89b-12d3-a456-426614174000
  AND event_date_bucket = '2025-12-15'
  AND event_timestamp >= '2025-12-15 14:00:00'
  AND event_timestamp < '2025-12-15 15:00:00';
```

#### –¢–∞–±–ª–∏—Ü–∞ 2: `events_by_type` (Q2)

**Partition Key**: `event_type, event_date_bucket`  
**Clustering Key**: `event_timestamp DESC`

```sql
CREATE TABLE events_by_type (
    event_type TEXT,                 -- Partition key
    event_date_bucket TEXT,          -- Partition key: '2025-12-15'
    event_timestamp TIMESTAMP,       -- Clustering key
    event_id TIMEUUID,               -- Clustering key
    
    user_id UUID,
    session_id TEXT,
    
    -- Event data
    page_url TEXT,
    product_id UUID,
    action TEXT,
    
    PRIMARY KEY ((event_type, event_date_bucket), event_timestamp, event_id)
) WITH CLUSTERING ORDER BY (event_timestamp DESC, event_id DESC);
```

**–ó–∞–ø—Ä–æ—Å—ã**:
```sql
-- –í—Å–µ 'add_to_cart' —Å–æ–±—ã—Ç–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è
SELECT * FROM events_by_type
WHERE event_type = 'add_to_cart'
  AND event_date_bucket = '2025-12-15';
```

### –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –º–æ–¥–µ–ª–µ–π

| –¢–∞–±–ª–∏—Ü–∞ | Partition Key | Clustering Key | –¶–µ–ª—å | –†–∞–∑–º–µ—Ä –ø–∞—Ä—Ç–∏—Ü–∏–∏ |
|---------|---------------|----------------|------|-----------------|
| `order_history_by_user` | `user_id` | `order_date DESC, order_id` | –ò—Å—Ç–æ—Ä–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ | ~100-500 –∑–∞–∫–∞–∑–æ–≤/user |
| `order_history_by_id` | `order_id` | - | Lookup –ø–æ ID | 1 –∑–∞–∫–∞–∑ |
| `order_history_by_date_and_status` | `(date_bucket, status)` | `order_date DESC, order_id` | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ | ~500k-1M –∑–∞–∫–∞–∑–æ–≤/–º–µ—Å—è—Ü |
| `carts_by_user` | `user_session_key` | `status, updated_at DESC` | –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã | 1-3 –∫–æ—Ä–∑–∏–Ω—ã/user |
| `abandoned_carts` | `abandoned_date_bucket` | `abandoned_at DESC, user_key` | –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ | ~10k-50k /–¥–µ–Ω—å |
| `user_sessions` | `session_id` | - | Lookup —Å–µ—Å—Å–∏–∏ | 1 —Å–µ—Å—Å–∏—è |
| `events_by_user` | `(user_id, date_bucket)` | `timestamp DESC, event_id` | Clickstream user | ~100-500 —Å–æ–±—ã—Ç–∏–π/–¥–µ–Ω—å/user |
| `events_by_type` | `(event_type, date_bucket)` | `timestamp DESC, event_id` | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π | ~100k-1M /–¥–µ–Ω—å/—Ç–∏–ø |

### –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ "–≥–æ—Ä—è—á–∏—Ö" –ø–∞—Ä—Ç–∏—Ü–∏–π

#### –ü—Ä–æ–±–ª–µ–º–∞: VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å 10,000 –∑–∞–∫–∞–∑–æ–≤

**–†–µ—à–µ–Ω–∏–µ 1**: Bucketing –ø–æ –≥–æ–¥—É/–º–µ—Å—è—Ü—É

```sql
CREATE TABLE order_history_by_user_bucketed (
    user_id UUID,
    order_year_month TEXT,           -- '2025-12' - bucketing
    order_date TIMESTAMP,
    order_id UUID,
    -- ...
    PRIMARY KEY ((user_id, order_year_month), order_date, order_id)
);

-- –ó–∞–ø—Ä–æ—Å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü (—Ç–æ–ª—å–∫–æ 1 –ø–∞—Ä—Ç–∏—Ü–∏—è)
SELECT * FROM order_history_by_user_bucketed
WHERE user_id = 123e4567-e89b-12d3-a456-426614174000
  AND order_year_month = '2025-12';

-- –ó–∞–ø—Ä–æ—Å –∑–∞ –≥–æ–¥ (12 –ø–∞—Ä—Ç–∏—Ü–∏–π - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
SELECT * FROM order_history_by_user_bucketed
WHERE user_id = 123e4567-e89b-12d3-a456-426614174000
  AND order_year_month IN ('2025-01', '2025-02', ..., '2025-12');
```

**–†–µ—à–µ–Ω–∏–µ 2**: Shard suffix (—Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)

```sql
CREATE TABLE events_sharded (
    user_id UUID,
    shard_id INT,                    -- 0-9 (10 —à–∞—Ä–¥–æ–≤)
    event_date_bucket TEXT,
    event_timestamp TIMESTAMP,
    event_id TIMEUUID,
    -- ...
    PRIMARY KEY ((user_id, shard_id, event_date_bucket), event_timestamp, event_id)
);

-- –í—Å—Ç–∞–≤–∫–∞: —Å–ª—É—á–∞–π–Ω—ã–π shard
INSERT INTO events_sharded (user_id, shard_id, event_date_bucket, ...)
VALUES (uuid(), random() % 10, '2025-12-15', ...);

-- –ß—Ç–µ–Ω–∏–µ: –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—Å–µ —à–∞—Ä–¥—ã (10 –ø–∞—Ä—Ç–∏—Ü–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
SELECT * FROM events_sharded
WHERE user_id = 123e4567-e89b-12d3-a456-426614174000
  AND shard_id IN (0, 1, 2, 3, 4, 5, 6, 7, 8, 9)
  AND event_date_bucket = '2025-12-15';
```

---

## –ó–∞–¥–∞–Ω–∏–µ 10.3: –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è

#### Replication Factor (RF)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π –¥–∞–Ω–Ω—ã—Ö –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ

```
RF = 3 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
Node 1: replica #1 ‚úÖ
Node 2: replica #2 ‚úÖ
Node 3: replica #3 ‚úÖ

–ï—Å–ª–∏ Node 1 –ø–∞–¥–∞–µ—Ç:
Node 2 –∏ Node 3 –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
```

#### Consistency Level (CL)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**: –°–∫–æ–ª—å–∫–æ —Ä–µ–ø–ª–∏–∫ –¥–æ–ª–∂–Ω—ã –æ—Ç–≤–µ—Ç–∏—Ç—å –¥–ª—è —É—Å–ø–µ—Ö–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏

| Level | –û–ø–∏—Å–∞–Ω–∏–µ | Writes | Reads | Latency | Consistency |
|-------|----------|--------|-------|---------|-------------|
| **ONE** | 1 —Ä–µ–ø–ª–∏–∫–∞ | –ë—ã—Å—Ç—Ä–æ | –ë—ã—Å—Ç—Ä–æ | –ù–∏–∑–∫–∞—è | Eventual |
| **QUORUM** | –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ (RF/2 + 1) | –°—Ä–µ–¥–Ω–µ | –°—Ä–µ–¥–Ω–µ | –°—Ä–µ–¥–Ω—è—è | Strong |
| **ALL** | –í—Å–µ —Ä–µ–ø–ª–∏–∫–∏ | –ú–µ–¥–ª–µ–Ω–Ω–æ | –ú–µ–¥–ª–µ–Ω–Ω–æ | –í—ã—Å–æ–∫–∞—è | Strongest |
| **LOCAL_QUORUM** | –ö–≤–æ—Ä—É–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º DC | –°—Ä–µ–¥–Ω–µ | –°—Ä–µ–¥–Ω–µ | –°—Ä–µ–¥–Ω—è—è | Strong (local) |

**–ü—Ä–∞–≤–∏–ª–æ Strong Consistency**:
```
W + R > RF

–ì–¥–µ:
W = write consistency level (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–¥)
R = read consistency level (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–¥)
RF = replication factor

–ü—Ä–∏–º–µ—Ä:
RF = 3, W = QUORUM (2), R = QUORUM (2)
2 + 2 > 3 ‚úÖ Strong consistency
```

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

#### 1. Hinted Handoff

**–ß—Ç–æ —ç—Ç–æ**: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –¥–ª—è —É–ø–∞–≤—à–µ–π –Ω–æ–¥—ã

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
```
–ó–∞–ø–∏—Å—å —Å CL=ONE, RF=3:

–ù–æ—Ä–º–∞:
Client ‚Üí Coordinator ‚Üí Node 1 (OK) ‚úÖ
                      ‚Üí Node 2 (OK) ‚úÖ
                      ‚Üí Node 3 (OK) ‚úÖ

Node 2 —É–ø–∞–ª–∞:
Client ‚Üí Coordinator ‚Üí Node 1 (OK) ‚úÖ
                      ‚Üí Node 2 (DOWN) ‚ùå
                      ‚Üí Node 3 (OK) ‚úÖ
                      ‚Üí Hint —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ Node 4 üìù

Node 2 –≤–µ—Ä–Ω—É–ª–∞—Å—å:
Node 4 ‚Üí Node 2: –æ—Ç–ø—Ä–∞–≤–∫–∞ hints ‚úÖ
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
```yaml
# cassandra.yaml
hinted_handoff_enabled: true
max_hint_window_in_ms: 10800000  # 3 —á–∞—Å–∞
hinted_handoff_throttle_in_kb: 1024
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—Ç–∫–∞–∑—ã –Ω–æ–¥ (< 3 —á–∞—Å–æ–≤)
- ‚úÖ –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- ‚ùå –ù–ï –∑–∞–º–µ–Ω—è–µ—Ç repair (—Ç–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

#### 2. Read Repair

**–ß—Ç–æ —ç—Ç–æ**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
```
Read —Å CL=QUORUM, RF=3:

Client ‚Üí Coordinator ‚Üí Node 1: {order_id: 123, status: 'paid'}
                      ‚Üí Node 2: {order_id: 123, status: 'paid'}
                      ‚Üí Node 3: {order_id: 123, status: 'pending'} ‚ùå

Coordinator –≤–∏–¥–∏—Ç –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:
1. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—É: status='paid' (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ)
2. –í —Ñ–æ–Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç Node 3: status='paid' ‚úÖ
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
```sql
-- –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å read repair (0.0 - 1.0)
ALTER TABLE orders_by_user
WITH read_repair_chance = 0.1           -- 10% reads
  AND dclocal_read_repair_chance = 0.1; -- 10% local DC reads
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å —á–∞—Å—Ç—ã–º —á—Ç–µ–Ω–∏–µ–º
- ‚úÖ –ö—Ä–∏—Ç–∏—á–Ω–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- ‚ö†Ô∏è –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç latency —á—Ç–µ–Ω–∏—è (—Ñ–æ–Ω–æ–≤—ã–π —Ä–µ–º–æ–Ω—Ç)

#### 3. Anti-Entropy Repair (Nodetool Repair)

**–ß—Ç–æ —ç—Ç–æ**: –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –Ω–æ–¥–∞–º–∏

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
```
Nodetool repair:

1. Coordinator —Å—Ç—Ä–æ–∏—Ç Merkle Tree –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏
2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç trees –º–µ–∂–¥—É –Ω–æ–¥–∞–º–∏
3. –ù–∞—Ö–æ–¥–∏—Ç —Ä–∞–∑–ª–∏—á–∏—è
4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ

Merkle Tree:
         Root
        /    \
      H1      H2
     / \     / \
   H11 H12 H21 H22
   
–ï—Å–ª–∏ H11 –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è:
‚Üí –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —ç—Ç—É –≤–µ—Ç–∫—É
```

**–ö–æ–º–∞–Ω–¥—ã**:
```bash
# –ü–æ–ª–Ω—ã–π repair –≤—Å–µ–≥–æ keyspace
nodetool repair keyspace_name

# Repair –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
nodetool repair keyspace_name table_name

# Incremental repair (–±—ã—Å—Ç—Ä–µ–µ)
nodetool repair -inc keyspace_name

# Repair –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏
nodetool repair -pr keyspace_name
```

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**:
```bash
# Cron: –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é
0 2 * * 0 nodetool repair -inc mobile_world
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)
- ‚úÖ –ü–æ—Å–ª–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ç–∫–∞–∑–∞ –Ω–æ–¥—ã (> 3 —á–∞—Å–æ–≤)
- ‚úÖ –ü–æ—Å–ª–µ –¥–µ–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚ö†Ô∏è –†–µ—Å—É—Ä—Å–æ–µ–º–∫–æ (–Ω–µ –≤–æ –≤—Ä–µ–º—è –ø–∏–∫–∞)

### –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏

#### Order History (–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- üü° –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–∞, –Ω–æ eventual OK (–¥–∞–Ω–Ω—ã–µ read-only)
- üü° Latency –≤–∞–∂–Ω–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏
- ‚úÖ Append-only (–Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, –Ω–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)

**–†–µ—à–µ–Ω–∏–µ**:

```sql
-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–±–ª–∏—Ü
CREATE TABLE order_history_by_user (
    -- ...
    PRIMARY KEY ((user_id), order_date, order_id)
) WITH read_repair_chance = 0.1  -- 10% read repair (–¥–∞–Ω–Ω—ã–µ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è)
  AND dclocal_read_repair_chance = 0.1;

-- Replication strategy
CREATE KEYSPACE mobile_world
WITH replication = {
  'class': 'NetworkTopologyStrategy',
  'datacenter1': 3,  -- RF=3
  'datacenter2': 3
};
```

**Consistency Levels**:
```python
# Write (–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ MongoDB –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞)
session.execute(
    insert_query,
    consistency_level=ConsistencyLevel.ONE  # –ë—ã—Å—Ç—Ä–æ, eventual OK
)

# Read (–¥–ª—è –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞)
session.execute(
    select_query,
    consistency_level=ConsistencyLevel.ONE  # Eventual OK (–¥–∞–Ω–Ω—ã–µ read-only)
)

# Read (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤)
session.execute(
    select_query,
    consistency_level=ConsistencyLevel.ONE  # –ë—ã—Å—Ç—Ä–æ
)
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏**:
- ‚úÖ **Hinted Handoff**: Enabled (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—Ç–∫–∞–∑—ã)
- ‚ö†Ô∏è **Read Repair**: 10% (–Ω–∏–∑–∫–∏–π overhead, –¥–∞–Ω–Ω—ã–µ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è)
- ‚úÖ **Anti-Entropy Repair**: –†–∞–∑ –≤ 2 –Ω–µ–¥–µ–ª–∏ (–∞—Ä—Ö–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- –î–∞–Ω–Ω—ã–µ read-only –ø–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏ ‚Üí eventual consistency OK
- –ò—Å—Ç–æ—Ä–∏—è –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞ ‚Üí ONE writes/reads (–±—ã—Å—Ç—Ä–æ)
- Read repair 10% ‚Üí –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π overhead
- –†–µ–≥—É–ª—è—Ä–Ω—ã–π repair —Ä–∞–∑ –≤ 2 –Ω–µ–¥–µ–ª–∏ ‚Üí –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∞—Ä—Ö–∏–≤–∞

#### Active Carts (–ö–æ—Ä–∑–∏–Ω—ã)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- üü° –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–∞, –Ω–æ eventual OK
- üî¥ Latency –∫—Ä–∏—Ç–∏—á–Ω–∞ (UX)
- ‚úÖ –ö–æ—Ä–æ—Ç–∫–∞—è –∂–∏–∑–Ω—å (TTL)

**–†–µ—à–µ–Ω–∏–µ**:

```sql
CREATE TABLE carts_by_user (
    -- ...
    PRIMARY KEY (user_session_key, status, updated_at)
) WITH read_repair_chance = 0.0  -- –û—Ç–∫–ª—é—á–µ–Ω (latency –≤–∞–∂–Ω–µ–µ)
  AND dclocal_read_repair_chance = 0.1  -- 10% local DC only
  AND default_time_to_live = 2592000;
```

**Consistency Levels**:
```python
# Write (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É)
session.execute(
    insert_query,
    consistency_level=ConsistencyLevel.ONE  # –ë—ã—Å—Ç—Ä–æ! UX –∫—Ä–∏—Ç–∏—á–µ–Ω
)

# Read (–ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã)
session.execute(
    select_query,
    consistency_level=ConsistencyLevel.ONE  # –ë—ã—Å—Ç—Ä–æ!
)

# Read (–ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞)
session.execute(
    select_query,
    consistency_level=ConsistencyLevel.QUORUM  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
)
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏**:
- ‚úÖ **Hinted Handoff**: Enabled (–±—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)
- ‚ö†Ô∏è **Read Repair**: 0% global, 10% local DC (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π overhead)
- ‚úÖ **Anti-Entropy Repair**: –†–∞–∑ –≤ 2 –Ω–µ–¥–µ–ª–∏ (–¥–∞–Ω–Ω—ã–µ –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–µ)

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- UX –∫—Ä–∏—Ç–∏—á–µ–Ω ‚Üí ONE writes/reads (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è latency)
- Eventual consistency OK ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–º–µ—Ç–∏—Ç –∑–∞–¥–µ—Ä–∂–∫—É 1-2 —Å–µ–∫
- TTL 30 –¥–Ω–µ–π ‚Üí —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—É–¥–∞–ª—è—é—Ç—Å—è
- –ü–µ—Ä–µ–¥ –∑–∞–∫–∞–∑–æ–º ‚Üí QUORUM read –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

#### User Sessions (–°–µ—Å—Å–∏–∏)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- üü¢ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞
- üî¥ Latency –∫—Ä–∏—Ç–∏—á–Ω–∞
- ‚úÖ –û—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∞—è –∂–∏–∑–Ω—å (30 –º–∏–Ω—É—Ç TTL)

**–†–µ—à–µ–Ω–∏–µ**:

```sql
CREATE TABLE user_sessions (
    -- ...
    PRIMARY KEY (session_id)
) WITH read_repair_chance = 0.0  -- –û—Ç–∫–ª—é—á–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é
  AND dclocal_read_repair_chance = 0.0
  AND default_time_to_live = 1800;  -- 30 –º–∏–Ω—É—Ç
```

**Consistency Levels**:
```python
# Write
session.execute(
    insert_query,
    consistency_level=ConsistencyLevel.ONE  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
)

# Read
session.execute(
    select_query,
    consistency_level=ConsistencyLevel.ONE  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
)
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏**:
- ‚úÖ **Hinted Handoff**: Enabled
- ‚ùå **Read Repair**: –û—Ç–∫–ª—é—á–µ–Ω (–Ω–µ –Ω—É–∂–µ–Ω)
- ‚ùå **Anti-Entropy Repair**: –ù–µ –Ω—É–∂–µ–Ω (TTL 30 –º–∏–Ω—É—Ç)

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- –°–µ—Å—Å–∏–∏ –∂–∏–≤—É—Ç 30 –º–∏–Ω—É—Ç ‚Üí eventual consistency OK
- Latency –∫—Ä–∏—Ç–∏—á–Ω–∞ ‚Üí ONE/ONE
- –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞ ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è
- Repair –Ω–µ –Ω—É–∂–µ–Ω ‚Üí –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–µ

#### Events & Clickstream (–°–æ–±—ã—Ç–∏—è)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- üü¢ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞
- üü° Latency —Å—Ä–µ–¥–Ω—è—è –≤–∞–∂–Ω–æ—Å—Ç—å
- ‚úÖ Append-only (write-heavy)

**–†–µ—à–µ–Ω–∏–µ**:

```sql
CREATE TABLE events_by_user (
    -- ...
    PRIMARY KEY ((user_id, event_date_bucket), event_timestamp, event_id)
) WITH read_repair_chance = 0.0  -- –û—Ç–∫–ª—é—á–µ–Ω
  AND dclocal_read_repair_chance = 0.0
  AND compaction = {
    'class': 'TimeWindowCompactionStrategy',
    'compaction_window_unit': 'DAYS',
    'compaction_window_size': 1
  };
```

**Consistency Levels**:
```python
# Write
session.execute(
    insert_query,
    consistency_level=ConsistencyLevel.ONE  # –ë—ã—Å—Ç—Ä—ã–µ writes
)

# Read (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
session.execute(
    select_query,
    consistency_level=ConsistencyLevel.ONE  # Eventual OK
)
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏**:
- ‚úÖ **Hinted Handoff**: Enabled
- ‚ùå **Read Repair**: –û—Ç–∫–ª—é—á–µ–Ω (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ eventual OK)
- ‚úÖ **Anti-Entropy Repair**: –†–∞–∑ –≤ –º–µ—Å—è—Ü (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ ‚Üí eventual consistency OK
- Write-heavy ‚Üí ONE writes (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è throughput)
- –ü–æ—Ç–µ—Ä—è 0.1% —Å–æ–±—ã—Ç–∏–π –¥–æ–ø—É—Å—Ç–∏–º–∞
- Repair —Ä–µ–¥–∫–æ ‚Üí –¥–∞–Ω–Ω—ã–µ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã

### –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

| –°—É—â–Ω–æ—Å—Ç—å | RF | Write CL | Read CL | Hinted Handoff | Read Repair | Anti-Entropy Repair | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|----------|----|---------| --------|----------------|-------------|---------------------|-------------|
| **Order History** | 3 | ONE | ONE | ‚úÖ Enabled | ‚ö†Ô∏è 10% | ‚úÖ Bi-weekly | –ê—Ä—Ö–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, read-only, eventual OK |
| **Carts** | 3 | ONE | ONE (view)<br/>QUORUM (checkout) | ‚úÖ Enabled | ‚ö†Ô∏è 0% (global)<br/>10% (local DC) | ‚úÖ Bi-weekly | UX –∫—Ä–∏—Ç–∏—á–µ–Ω, eventual OK |
| **Sessions** | 3 | ONE | ONE | ‚úÖ Enabled | ‚ùå Disabled | ‚ùå Not needed | –û—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∞—è –∂–∏–∑–Ω—å, latency –∫—Ä–∏—Ç–∏—á–Ω–∞ |
| **Events** | 3 | ONE | ONE | ‚úÖ Enabled | ‚ùå Disabled | ‚ö†Ô∏è Monthly | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞, eventual OK, write-heavy |

### –ö–æ–º–ø—Ä–æ–º–∏—Å—Å—ã

#### Latency vs Consistency

```
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è Consistency:
RF=3, W=ALL, R=ALL
Latency: HIGH (–∂–¥–µ–º –≤—Å–µ 3 –Ω–æ–¥—ã)
Availability: LOW (–æ–¥–Ω–∞ —É–ø–∞–ª–∞ = –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ)

–ë–∞–ª–∞–Ω—Å (QUORUM):
RF=3, W=QUORUM, R=QUORUM
Latency: MEDIUM (–∂–¥–µ–º 2 –Ω–æ–¥—ã)
Availability: HIGH (—Ç–µ—Ä–ø–∏—Ç 1 –æ—Ç–∫–∞–∑)
Consistency: STRONG (W+R > RF)

–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è Latency:
RF=3, W=ONE, R=ONE
Latency: LOW (–∂–¥–µ–º 1 –Ω–æ–¥—É)
Availability: HIGHEST (—Ç–µ—Ä–ø–∏—Ç 2 –æ—Ç–∫–∞–∑–∞)
Consistency: EVENTUAL
```

#### Read Repair Overhead

```
read_repair_chance = 0.0:
Latency: 10ms
Consistency: Eventual

read_repair_chance = 0.2:
Latency: 12ms (+20%)
Consistency: Better (20% reads —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è)

read_repair_chance = 1.0:
Latency: 20ms (+100%)
Consistency: Strong (–≤—Å–µ reads —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è)
```

**–í—ã–≤–æ–¥**: –ò—Å–ø–æ–ª—å–∑—É–µ–º 0-20% –¥–ª—è –±–∞–ª–∞–Ω—Å–∞

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ    API Gateway          ‚îÇ
                        ‚îÇ    (Kong / nginx)       ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                   ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ                             ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ   MongoDB      ‚îÇ           ‚îÇ   Cassandra    ‚îÇ
            ‚îÇ   Cluster      ‚îÇ           ‚îÇ   Cluster      ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ                             ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                      ‚îÇ      ‚îÇ                         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îê  ‚îå‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îê
    ‚îÇ users   ‚îÇ         ‚îÇproducts‚îÇ  ‚îÇ  orders   ‚îÇ  ‚îÇ   carts   ‚îÇ
    ‚îÇinventory‚îÇ         ‚îÇ        ‚îÇ  ‚îÇ  sessions ‚îÇ  ‚îÇ   events  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ACID needed         Read-heavy   Write-heavy     Time-series
```

### –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

**–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (Python)**:

```python
from cassandra.cluster import Cluster
from pymongo import MongoClient

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è
mongo_client = MongoClient('mongodb://mongos:27017/')
mongo_db = mongo_client.mobile_world

cassandra_cluster = Cluster(['cassandra1', 'cassandra2', 'cassandra3'])
cassandra_session = cassandra_cluster.connect('mobile_world')

# –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
class DataService:
    def get_user(self, user_id):
        # MongoDB: users
        return mongo_db.users.find_one({"user_id": user_id})
    
    def get_products(self, category):
        # MongoDB: products
        return mongo_db.products.find({"category": category})
    
    def create_order(self, order_data):
        # MongoDB: —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
        with mongo_client.start_session() as session:
            with session.start_transaction():
                # 1. –°–ø–∏—Å–∞—Ç—å –æ—Å—Ç–∞—Ç–∫–∏
                product = mongo_db.products.find_one_and_update(
                    {"_id": order_data["product_id"], "stock": {"$gte": order_data["quantity"]}},
                    {"$inc": {"stock": -order_data["quantity"]}},
                    session=session
                )
                if not product:
                    raise Exception("Out of stock")
                
                # 2. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
                result = mongo_db.orders.insert_one(order_data, session=session)
                return result
    
    def complete_order(self, order_id):
        # 1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ MongoDB
        order = mongo_db.orders.find_one_and_update(
            {"_id": order_id},
            {"$set": {"status": "delivered", "completed_at": datetime.now()}}
        )
        
        # 2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ Cassandra (order_history)
        query = "INSERT INTO order_history_by_user (...) VALUES (...)"
        cassandra_session.execute(query, order)
    
    def get_order_history(self, user_id):
        # Cassandra: –∏—Å—Ç–æ—Ä–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
        query = "SELECT * FROM order_history_by_user WHERE user_id = ? LIMIT 10"
        return cassandra_session.execute(query, [user_id])
    
    def get_user_cart(self, user_id):
        # Cassandra: carts (write-heavy)
        query = "SELECT * FROM carts_by_user WHERE user_session_key = ?"
        return cassandra_session.execute(query, [user_id])
    
    def track_event(self, event_data):
        # Cassandra: events (write-only)
        query = "INSERT INTO events_by_user (...) VALUES (...)"
        cassandra_session.execute(query, ...)
```

### Multi-Datacenter Replication

**Cassandra Configuration**:

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ keyspace —Å multi-DC —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π
CREATE KEYSPACE mobile_world
WITH replication = {
  'class': 'NetworkTopologyStrategy',
  'dc_us_east': 3,      -- 3 —Ä–µ–ø–ª–∏–∫–∏ –≤ US East
  'dc_eu_west': 3,      -- 3 —Ä–µ–ø–ª–∏–∫–∏ –≤ EU West
  'dc_asia_pacific': 2  -- 2 —Ä–µ–ø–ª–∏–∫–∏ –≤ Asia Pacific
};
```

**Consistency Levels –¥–ª—è multi-DC**:

```python
from cassandra import ConsistencyLevel

# Write: –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–≤–æ—Ä—É–º (–±—ã—Å—Ç—Ä–æ)
session.execute(
    query,
    consistency_level=ConsistencyLevel.LOCAL_QUORUM  # –ö–≤–æ—Ä—É–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º DC
)

# Read: –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–≤–æ—Ä—É–º (–Ω–∏–∑–∫–∞—è latency)
session.execute(
    query,
    consistency_level=ConsistencyLevel.LOCAL_QUORUM
)

# Critical read: –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–≤–æ—Ä—É–º (–º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ consistent)
session.execute(
    query,
    consistency_level=ConsistencyLevel.EACH_QUORUM  # –ö–≤–æ—Ä—É–º –≤ –∫–∞–∂–¥–æ–º DC
)
```

---

## –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1-2 –Ω–µ–¥–µ–ª–∏)

**1.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Cassandra –∫–ª–∞—Å—Ç–µ—Ä–∞**

```bash
# 3-–Ω–æ–¥–æ–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä (minimum)
docker-compose.yml:

version: '3'
services:
  cassandra1:
    image: cassandra:latest
    environment:
      - CASSANDRA_CLUSTER_NAME=mobile_world
      - CASSANDRA_SEEDS=cassandra1
      - CASSANDRA_DC=datacenter1
      - CASSANDRA_RACK=rack1
    ports:
      - "9042:9042"
    volumes:
      - cassandra1_data:/var/lib/cassandra
  
  cassandra2:
    image: cassandra:latest
    environment:
      - CASSANDRA_CLUSTER_NAME=mobile_world
      - CASSANDRA_SEEDS=cassandra1
      - CASSANDRA_DC=datacenter1
      - CASSANDRA_RACK=rack2
    volumes:
      - cassandra2_data:/var/lib/cassandra
  
  cassandra3:
    image: cassandra:latest
    environment:
      - CASSANDRA_CLUSTER_NAME=mobile_world
      - CASSANDRA_SEEDS=cassandra1
      - CASSANDRA_DC=datacenter1
      - CASSANDRA_RACK=rack3
    volumes:
      - cassandra3_data:/var/lib/cassandra
```

**1.2 –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º**

```bash
# –ó–∞–ø—É—Å–∫ cqlsh
docker exec -it cassandra1 cqlsh

# –°–æ–∑–¥–∞–Ω–∏–µ keyspace
CREATE KEYSPACE mobile_world
WITH replication = {
  'class': 'NetworkTopologyStrategy',
  'datacenter1': 3
};

USE mobile_world;

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (—Å–º. —Ä–∞–∑–¥–µ–ª 10.2)
CREATE TABLE order_history_by_user (...);
CREATE TABLE order_history_by_id (...);
CREATE TABLE order_history_by_date_and_status (...);
CREATE TABLE carts_by_user (...);
CREATE TABLE user_sessions (...);
CREATE TABLE events_by_user (...);
# ...
```

**1.3 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

```python
# Benchmark script
import time
from cassandra.cluster import Cluster

cluster = Cluster(['cassandra1'])
session = cluster.connect('mobile_world')

# Write benchmark
start = time.time()
for i in range(10000):
    session.execute(
        "INSERT INTO order_history_by_user (...) VALUES (...)",
        [...]
    )
end = time.time()
print(f"10k writes: {end - start:.2f}s")
print(f"Throughput: {10000 / (end - start):.0f} writes/sec")
```

### –≠—Ç–∞–ø 2: Dual-Write (2-4 –Ω–µ–¥–µ–ª–∏)

**–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –∫–æ–ø–∏—Ä—É–µ–º –≤ Cassandra**

```python
def complete_order(order_id):
    # 1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ MongoDB (–∞–∫—Ç–∏–≤–Ω—ã–π ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π)
    order = mongo_db.orders.find_one_and_update(
        {"_id": order_id},
        {"$set": {"status": "delivered", "completed_at": datetime.now()}},
        return_document=ReturnDocument.AFTER
    )
    
    # 2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑ –≤ Cassandra (order_history)
    try:
        # –í—Å—Ç–∞–≤–∫–∞ –≤ order_history_by_user
        cassandra_session.execute(
            """
            INSERT INTO order_history_by_user 
            (user_id, order_date, order_id, status, total_amount, currency, items, ...)
            VALUES (?, ?, ?, ?, ?, ?, ?, ...)
            """,
            [order["user_id"], order["order_date"], order["_id"], ...]
        )
        
        # –í—Å—Ç–∞–≤–∫–∞ –≤ order_history_by_id
        cassandra_session.execute(
            "INSERT INTO order_history_by_id (...) VALUES (...)",
            [...]
        )
    except Exception as e:
        # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        logger.error(f"Cassandra write failed for order {order_id}: {e}")
    
    return order
```

**‚ö†Ô∏è –í–ê–ñ–ù–û**: –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã (pending, processing) –æ—Å—Ç–∞—é—Ç—Å—è –¢–û–õ–¨–ö–û –≤ MongoDB!

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**:

```python
# –°–∫—Ä–∏–ø—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
def compare_data():
    # MongoDB: –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ Cassandra)
    mongo_completed_orders = mongo_db.orders.count_documents({
        "status": {"$in": ["delivered", "cancelled", "returned"]}
    })
    
    # Cassandra: –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤
    cassandra_orders = cassandra_session.execute(
        "SELECT COUNT(*) FROM order_history_by_user"
    ).one()[0]
    
    diff = abs(mongo_completed_orders - cassandra_orders)
    print(f"MongoDB completed orders: {mongo_completed_orders}")
    print(f"Cassandra order history: {cassandra_orders}")
    print(f"Difference: {diff} orders ({diff / mongo_completed_orders * 100:.2f}%)")
    
    if diff / mongo_completed_orders > 0.01:  # > 1% —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ
        print("‚ö†Ô∏è WARNING: Too many missing orders in Cassandra!")
```

### –≠—Ç–∞–ø 3: Backfill (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –≠—Ç–∞–ø–æ–º 2)

**–ú–∏–≥—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤**

```python
# Migration script
from pymongo import MongoClient
from cassandra.cluster import Cluster
import datetime

mongo_client = MongoClient('mongodb://mongos:27017/')
mongo_db = mongo_client.mobile_world

cassandra_cluster = Cluster(['cassandra1'])
cassandra_session = cassandra_cluster.connect('mobile_world')

# –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ statements (–±—ã—Å—Ç—Ä–µ–µ)
insert_by_user_stmt = cassandra_session.prepare(
    """
    INSERT INTO order_history_by_user 
    (user_id, order_date, order_id, status, total_amount, currency, items, ...)
    VALUES (?, ?, ?, ?, ?, ?, ?, ...)
    """
)

insert_by_id_stmt = cassandra_session.prepare(
    "INSERT INTO order_history_by_id (order_id, user_id, ...) VALUES (?, ?, ...)"
)

# –ú–∏–≥—Ä–∞—Ü–∏—è –¢–û–õ–¨–ö–û –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
batch_size = 1000
cursor = mongo_db.orders.find({
    "status": {"$in": ["delivered", "cancelled", "returned"]}
}).batch_size(batch_size)

migrated = 0
for order in cursor:
    # –í—Å—Ç–∞–≤–∫–∞ –≤ order_history_by_user
    cassandra_session.execute(insert_by_user_stmt, [
        order['user_id'],
        order['order_date'],
        order['_id'],
        order['status'],
        order['total_amount'],
        order['currency'],
        order['items'],
        # ...
    ])
    
    # –í—Å—Ç–∞–≤–∫–∞ –≤ order_history_by_id
    cassandra_session.execute(insert_by_id_stmt, [
        order['_id'],
        order['user_id'],
        # ...
    ])
    
    migrated += 1
    if migrated % 10000 == 0:
        print(f"Migrated {migrated} completed orders")

print(f"Total migrated: {migrated} completed orders")
print(f"Active orders remain in MongoDB")
```

### –≠—Ç–∞–ø 4: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —á—Ç–µ–Ω–∏–µ (1 –Ω–µ–¥–µ–ª—è)

**–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —á—Ç–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞ Cassandra**

```python
# Feature flag
USE_CASSANDRA_HISTORY = os.getenv('USE_CASSANDRA_HISTORY', 'false') == 'true'

def get_user_order_history(user_id):
    """–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ó–ê–í–ï–†–®–ï–ù–ù–´–• –∑–∞–∫–∞–∑–æ–≤"""
    if USE_CASSANDRA_HISTORY:
        # –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (Cassandra) - –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
        result = cassandra_session.execute(
            "SELECT * FROM order_history_by_user WHERE user_id = ? LIMIT 10",
            [user_id]
        )
        return list(result)
    else:
        # –°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ (MongoDB)
        return list(mongo_db.orders.find({
            "user_id": user_id,
            "status": {"$in": ["delivered", "cancelled", "returned"]}
        }).limit(10))

def get_active_orders(user_id):
    """–ü–æ–ª—É—á–∏—Ç—å –ê–ö–¢–ò–í–ù–´–ï –∑–∞–∫–∞–∑—ã - –≤—Å–µ–≥–¥–∞ –∏–∑ MongoDB"""
    return list(mongo_db.orders.find({
        "user_id": user_id,
        "status": {"$in": ["pending", "processing", "shipped"]}
    }))
```

**Canary deployment**:
```
Week 1: 10% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí Cassandra history reads
Week 2: 25% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí Cassandra history reads
Week 3: 50% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí Cassandra history reads
Week 4: 100% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí Cassandra history reads

‚ö†Ô∏è –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã –í–°–ï–ì–î–ê —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ MongoDB
```

### –≠—Ç–∞–ø 5: –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Å–ª–µ 2-4 –Ω–µ–¥–µ–ª—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)

**‚ö†Ô∏è –í–ê–ñ–ù–û**: MongoDB –ù–ï –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –¥–ª—è –∑–∞–∫–∞–∑–æ–≤! –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤ MongoDB.

**–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ MongoDB (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**

```bash
# Backup —Å—Ç–∞—Ä—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
mongodump --uri="mongodb://mongos:27017/mobile_world" \
  --collection=orders \
  --query='{"status": {"$in": ["delivered", "cancelled", "returned"]}, "completed_at": {"$lt": "2025-01-01"}}' \
  --out=/backup

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –∏–∑ MongoDB (—É–∂–µ –≤ Cassandra)
mongo mobile_world --eval '
db.orders.deleteMany({
  status: {$in: ["delivered", "cancelled", "returned"]},
  completed_at: {$lt: new Date("2025-01-01")}
})
'
```

**–ß—Ç–æ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ MongoDB –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏**:
- ‚úÖ –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã (pending, processing, shipped)
- ‚úÖ –ù–µ–¥–∞–≤–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 3-6 –º–µ—Å—è—Ü–µ–≤)
- ‚úÖ Products —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏
- ‚úÖ Users

**–ß—Ç–æ –≤ Cassandra**:
- ‚úÖ –í—Å—è –∏—Å—Ç–æ—Ä–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ (100M+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
- ‚úÖ –ê—Ä—Ö–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

### –ú–µ—Ç—Ä–∏–∫–∏ Cassandra

```bash
# Nodetool status
nodetool status

# Output:
# Datacenter: datacenter1
# =======================
# Status=Up/Down
# |/ State=Normal/Leaving/Joining/Moving
# --  Address    Load       Tokens  Owns    Rack
# UN  cassandra1 10.5 GB    256     33.3%   rack1
# UN  cassandra2 10.3 GB    256     33.4%   rack2
# UN  cassandra3 10.4 GB    256     33.3%   rack3
```

### Prometheus + Grafana

**JMX Exporter –¥–ª—è Cassandra**:

```yaml
# docker-compose.yml
cassandra1:
  image: cassandra:latest
  environment:
    - JMX_PORT=7199
    - LOCAL_JMX=no
  ports:
    - "7199:7199"  # JMX
    - "9042:9042"  # CQL

jmx_exporter:
  image: sscaling/jmx-prometheus-exporter
  ports:
    - "5556:5556"
  environment:
    - SERVICE_PORT=5556
  volumes:
    - ./cassandra-jmx-config.yml:/etc/jmx-exporter/config.yml
  command:
    - "5556"
    - "/etc/jmx-exporter/config.yml"
```

**Grafana Dashboard**: Import `Cassandra Overview` (ID: 6144)

### –ê–ª–µ—Ä—Ç—ã

```yaml
# prometheus_alerts.yml
groups:
  - name: cassandra
    rules:
      - alert: CassandraNodeDown
        expr: up{job="cassandra"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Cassandra node {{ $labels.instance }} is down"
      
      - alert: HighReadLatency
        expr: cassandra_clientrequest_latency_seconds{quantile="0.99"} > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High read latency on {{ $labels.instance }}"
      
      - alert: HighWriteLatency
        expr: cassandra_clientrequest_write_latency_seconds{quantile="0.99"} > 0.05
        for: 5m
        labels:
          severity: warning
          summary: "High write latency on {{ $labels.instance }}"
```

---

## –ò—Ç–æ–≥–∏

### –ü—Ä–æ–±–ª–µ–º—ã MongoDB (—Ä–µ—à–∞–µ–º—ã–µ Cassandra)

| –ü—Ä–æ–±–ª–µ–º–∞ | MongoDB | Cassandra |
|----------|---------|-----------|
| **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–¥** | –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (—á–∞—Å—ã) | Consistent hashing (–º–∏–Ω—É—Ç—ã) |
| **Write bottleneck** | Primary –Ω–æ–¥–∞ | Leaderless (–≤—Å–µ –Ω–æ–¥—ã —Ä–∞–≤–Ω—ã) |
| **–ì–æ—Ä—è—á–∏–µ —à–∞—Ä–¥—ã** | Range-based chunks | Hash-based partition keys |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ú–µ–¥–ª–µ–Ω–Ω–æ–µ | –õ–∏–Ω–µ–π–Ω–æ–µ |
| **Latency –ø—Ä–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ** | –í—ã—Å–æ–∫–∞—è (+300-500ms) | –ù–∏–∑–∫–∞—è (–Ω–µ–∑–∞–º–µ—Ç–Ω–æ) |

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

‚úÖ **MongoDB** –¥–ª—è:
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (users, active orders, products —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏)
- **–°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** (products —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫)
- **ACID —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è** (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ + —Å–ø–∏—Å–∞–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤)

‚úÖ **Cassandra** –¥–ª—è:
- **Write-heavy –¥–∞–Ω–Ω—ã–µ** (order_history, carts, sessions, events)
- **Time-series** (clickstream, –∞—Ä—Ö–∏–≤—ã)
- **–í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** (99.99%)
- **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** –±–µ–∑ –ø–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ (MongoDB) | –ü–æ—Å–ª–µ (Cassandra) | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|--------------|-------------------|-----------|
| **Write latency (p99)** | 150ms | **15ms** | üìâ -90% |
| **Write throughput** | 5,000/sec | **50,000/sec** | üìà +900% |
| **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–¥—ã** | 4-6 —á–∞—Å–æ–≤ | **10-15 –º–∏–Ω—É—Ç** | ‚ö° +24x –±—ã—Å—Ç—Ä–µ–µ |
| **Latency –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏** | +300-500ms | **+5-10ms** | üìâ -95% |
| **Availability** | 99.9% | **99.99%** | üìà +0.09% |

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- üìñ [TASK9_SUMMARY.md](TASK9_SUMMARY.md) - —á—Ç–µ–Ω–∏–µ —Å —Ä–µ–ø–ª–∏–∫ (MongoDB)
- üî• [TASK8_SUMMARY.md](TASK8_SUMMARY.md) - "–≥–æ—Ä—è—á–∏–µ" —à–∞—Ä–¥—ã (MongoDB)
- üìê [TASK7_SUMMARY.md](TASK7_SUMMARY.md) - –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–π (MongoDB)
- üè† [README.md](../README.md) - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞

---

**‚úÖ –ó–∞–¥–∞–Ω–∏–µ 10 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!**

**–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –≥–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö:**

**üî¥ MongoDB** (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ACID):
- ‚úÖ **Active Orders** + **Products** (–∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ + —Å–ø–∏—Å–∞–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤)
- ‚úÖ **Users** (ACID –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–µ–π –∏ –±–∞–ª–∞–Ω—Å–æ–≤)
- ‚ö†Ô∏è –†–∏—Å–∫ overselling –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω —á–µ—Ä–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**‚úÖ Cassandra** (write-heavy, –∞—Ä—Ö–∏–≤—ã):
- ‚ö° **Order History** (–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã) - 10x throughput –¥–ª—è writes
- üöÄ **Carts, Sessions, Events** - –±—ã—Å—Ç—Ä—ã–µ writes, eventual consistency OK
- üéØ **99.99% availability** —á–µ—Ä–µ–∑ leaderless —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é
- üìâ **-90% write latency** –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤

**üéâ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –Ω–∞–≥—Ä—É–∑–∫–µ 50,000+ –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫ –±–µ–∑ —Ä–∏—Å–∫–∞ overselling!**

