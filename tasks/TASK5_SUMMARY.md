# –ó–∞–¥–∞–Ω–∏–µ 5: Service Discovery –∏ API Gateway - –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞

> üåê –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å API Gateway –∏ Consul  
> üè† [‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ README](../README.md) | üé® [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](../diagrams/ARCHITECTURE.md)

---

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### –°–æ–∑–¥–∞–Ω–∞ –°—Ö–µ–º–∞ 4: API Gateway + Service Discovery

–î–æ–±–∞–≤–ª–µ–Ω–∞ —á–µ—Ç–≤—ë—Ä—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å—Ö–µ–º–∞, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∞—è:
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (3 —à—Ç) –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- **API Gateway** (nginx/Kong) –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
- **Consul** –¥–ª—è Service Discovery –∏ health checks
- **–°–µ—Ç–µ–≤—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è** –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

**–§–∞–π–ª—ã:**
- `diagrams/04-sharding-replication-caching-gateway.mmd` - –∏—Å—Ö–æ–¥–Ω—ã–π Mermaid —Ñ–∞–π–ª
- `diagrams/ARCHITECTURE.md` - –æ–±–Ω–æ–≤–ª—ë–Ω —Å –°—Ö–µ–º–æ–π 4
- `diagrams/output/04-*.png` - –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω GitHub Actions

---

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞ single point of failure –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è (–ó–∞–¥–∞–Ω–∏–µ 4):**
> –£ –æ–Ω–ª–∞–π–Ω-–º–∞–≥–∞–∑–∏–Ω–∞ "–ú–æ–±–∏–ª—å–Ω—ã–π –º–∏—Ä" —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç —Ç–æ–ª—å–∫–æ **–æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**. –≠—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–∏ –≤ —Å–ª—É—á–∞–µ:
> - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
> - –ü–∞–¥–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑-–∑–∞ –±–∞–≥–∞
> - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –û–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π (—á–µ—Ä–Ω–∞—è –ø—è—Ç–Ω–∏—Ü–∞)
- ‚ùå –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç –ø—Ä–æ—Å—Ç–æ—è —Å–∞–π—Ç–∞
- ‚ùå –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –∏–Ω—Å—Ç–∞–Ω—Å–∞ - –≤–µ—Å—å —Å–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ **API Gateway** - –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫
- ‚úÖ **Service Discovery** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
- ‚úÖ **Zero-downtime deployments** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –°—Ö–µ–º—ã 4

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–≤—Å–µ–≥–æ 15 —Å–µ—Ä–≤–∏—Å–æ–≤)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü–æ—Ä—Ç—ã | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|-------|------------|
| **API Gateway** | 1 | 80 | –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ |
| **Consul** | 1 | 8500 | Service Discovery, health checks |
| **pymongo-api** | **3** | 8081, 8082, 8083 | –ò–Ω—Å—Ç–∞–Ω—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ) |
| Redis | 1 | 6379 | –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ |
| mongos | 1 | 27017 | MongoDB Router |
| Config Servers | 3 | 27019 | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (replica set) |
| Shard 1 Replicas | 3 | 27018 | –î–∞–Ω–Ω—ã–µ (replica set) |
| Shard 2 Replicas | 3 | 27018 | –î–∞–Ω–Ω—ã–µ (replica set) |
| **–í—Å–µ–≥–æ** | **15** | | |

### –ü–æ—Ç–æ–∫ –∑–∞–ø—Ä–æ—Å–∞

```
Client
  ‚Üì
  ‚Üì HTTP Request (port 80)
  ‚Üì
API Gateway
  ‚îÇ
  ‚îú‚Üí Consul: –ö–∞–∫–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã?
  ‚îÇ  Consul: api-1 ‚úÖ, api-2 ‚úÖ, api-3 ‚úÖ
  ‚îÇ
  ‚îú‚Üí Round Robin –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
  ‚Üì
pymongo-api-1 | pymongo-api-2 | pymongo-api-3
  ‚îÇ               ‚îÇ               ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ       Redis (Cache Check)     ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ               ‚îÇ               ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí mongos ‚Üí Shards
```

### –ö–ª—é—á–µ–≤—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

**1. Service Registration (–ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ):**
```
pymongo-api-1 ‚Üí Consul: "–Ø –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8081"
pymongo-api-2 ‚Üí Consul: "–Ø –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8082"
pymongo-api-3 ‚Üí Consul: "–Ø –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8083"
```

**2. Health Checks (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ):**
```
Consul ‚Üí pymongo-api-1: GET /health ‚Üí 200 OK ‚úÖ
Consul ‚Üí pymongo-api-2: GET /health ‚Üí 200 OK ‚úÖ
Consul ‚Üí pymongo-api-3: GET /health ‚Üí Timeout ‚ùå

Consul: –ò—Å–∫–ª—é—á–∞—é api-3 –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
```

**3. Service Discovery (–ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ):**
```
API Gateway ‚Üí Consul: "–ö–∞–∫–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã pymongo-api –¥–æ—Å—Ç—É–ø–Ω—ã?"
Consul ‚Üí API Gateway: ["api-1:8081", "api-2:8082"]

API Gateway: –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å –Ω–∞ api-1 (Round Robin)
```

**4. Load Balancing (Round Robin):**
```
Request 1 ‚Üí API Gateway ‚Üí api-1
Request 2 ‚Üí API Gateway ‚Üí api-2
Request 3 ‚Üí API Gateway ‚Üí api-1
Request 4 ‚Üí API Gateway ‚Üí api-2
```

---

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –°—Ö–µ–º—ã 4

### 1. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ë–µ–∑ API Gateway (–°—Ö–µ–º–∞ 3):**
- 1 –∏–Ω—Å—Ç–∞–Ω—Å = –º–∞–∫—Å–∏–º—É–º 100 req/sec
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–° API Gateway (–°—Ö–µ–º–∞ 4):**
- 3 –∏–Ω—Å—Ç–∞–Ω—Å–∞ = 300 req/sec ‚úÖ
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –µ—â—ë –∏–Ω—Å—Ç–∞–Ω—Å—ã: 10 –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ = 1000 req/sec
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç MongoDB

### 2. –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ü–∞–¥–∞–µ—Ç –æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ë–µ–∑ API Gateway:**
```
pymongo-api ‚ùå ‚Üí –°–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```

**–° API Gateway:**
```
pymongo-api-1 ‚úÖ
pymongo-api-2 ‚ùå (—É–ø–∞–ª)
pymongo-api-3 ‚úÖ

Consul: –ò—Å–∫–ª—é—á–∞—é api-2 –∏–∑ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
API Gateway: –û—Ç–ø—Ä–∞–≤–ª—è—é —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ api-1 –∏ api-3
‚Üí –°–∞–π—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å! ‚úÖ
```

### 3. Zero-downtime deployments

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è:**
```
1. –î–µ–ø–ª–æ–π –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –Ω–∞ api-1
   API Gateway: api-1 ‚ùå (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è), api-2 ‚úÖ, api-3 ‚úÖ

2. api-1 –∑–∞–ø—É—Å—Ç–∏–ª—Å—è —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π
   Consul: api-1 ‚úÖ (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)

3. –î–µ–ø–ª–æ–π –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –Ω–∞ api-2
   API Gateway: api-1 ‚úÖ, api-2 ‚ùå (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è), api-3 ‚úÖ

4. –î–µ–ø–ª–æ–π –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –Ω–∞ api-3
   API Gateway: api-1 ‚úÖ, api-2 ‚úÖ, api-3 ‚ùå (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)

5. –ì–æ—Ç–æ–≤–æ!
   –í—Å–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π, —Å–∞–π—Ç –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è!
```

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏

**–ë–µ–∑ Consul:**
- –î–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–π –∏–Ω—Å—Ç–∞–Ω—Å ‚Üí –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞
- –ò–Ω—Å—Ç–∞–Ω—Å —É–ø–∞–ª ‚Üí —Ç—Ä–∞—Ñ–∏–∫ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è, –æ—à–∏–±–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞–º

**–° Consul:**
- –î–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–π –∏–Ω—Å—Ç–∞–Ω—Å ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ ‚úÖ
- –ò–Ω—Å—Ç–∞–Ω—Å —É–ø–∞–ª ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è, –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ –≤–∏–¥—è—Ç –æ—à–∏–±–æ–∫ ‚úÖ

---

## üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ö–µ–º

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –°—Ö–µ–º–∞ 3 | –°—Ö–µ–º–∞ 4 | –£–ª—É—á—à–µ–Ω–∏–µ |
|----------------|---------|---------|-----------|
| –ò–Ω—Å—Ç–∞–Ω—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | 1 | 3 | 3x |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | 100 req/sec | 300 req/sec | 3x |
| –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | ‚ùå | ‚úÖ | –ü–æ—è–≤–∏–ª–∞—Å—å |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏—è | –° –ø—Ä–æ—Å—Ç–æ–µ–º | –ë–µ–∑ –ø—Ä–æ—Å—Ç–æ—è | –ù–µ—Ç –ø—Ä–æ—Å—Ç–æ—è |
| –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ | –ù–µ—Ç | ‚úÖ Round Robin | –ü–æ—è–≤–∏–ª–∞—Å—å |
| Service Discovery | –ù–µ—Ç | ‚úÖ Consul | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ |
| –í—Å–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ | 12 | **15** | +3 |

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### API Gateway (nginx/Kong)

**–§—É–Ω–∫—Ü–∏–∏:**
- **Reverse Proxy** - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
- **Load Balancing** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏ (Round Robin, Least Connections, IP Hash)
- **Health Checks** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
- **Rate Limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- **SSL Termination** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTPS
- **Request/Response Transformation** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ auth

**–ê–ª–≥–æ—Ä–∏—Ç–º—ã –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏:**
- **Round Robin** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) - –ø–æ –æ—á–µ—Ä–µ–¥–∏: 1 ‚Üí 2 ‚Üí 3 ‚Üí 1...
- **Least Connections** - –Ω–∞ –∏–Ω—Å—Ç–∞–Ω—Å —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **IP Hash** - –æ–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç –≤—Å–µ–≥–¥–∞ –Ω–∞ –æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å (sticky sessions)

### Consul

**–§—É–Ω–∫—Ü–∏–∏:**
- **Service Registry** - —Ö—Ä–∞–Ω–∏—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –∏ –∏—Ö –∞–¥—Ä–µ—Å–∞
- **Health Checking** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ (HTTP, TCP, gRPC)
- **Service Discovery** - API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
- **Key-Value Store** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **Multi-Datacenter** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–æ–≤

**Health Checks:**
```json
{
  "service": {
    "name": "pymongo-api",
    "port": 8081,
    "check": {
      "http": "http://localhost:8081/health",
      "interval": "10s",
      "timeout": "1s"
    }
  }
}
```

### –¢–∏–ø—ã –Ω–∞–≥—Ä—É–∑–∫–∏

**–î–æ (–°—Ö–µ–º–∞ 3):**
```
1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí 1 –∏–Ω—Å—Ç–∞–Ω—Å
1 –∏–Ω—Å—Ç–∞–Ω—Å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω ‚Üí –º–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã/–æ—à–∏–±–∫–∏
```

**–ü–æ—Å–ª–µ (–°—Ö–µ–º–∞ 4):**
```
1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí API Gateway ‚Üí 3 –∏–Ω—Å—Ç–∞–Ω—Å–∞
333 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –∏–Ω—Å—Ç–∞–Ω—Å ‚Üí –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã ‚úÖ
```

---

## üéì –ß—Ç–æ —É–∑–Ω–∞–ª–∏

### 1. –ü–∞—Ç—Ç–µ—Ä–Ω API Gateway

- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- –°–∫—Ä—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

### 2. Service Discovery –ø–∞—Ç—Ç–µ—Ä–Ω

- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–¥–µ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- Health checks –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

### 3. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ vs –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ (Scale Up):**
- –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ CPU/RAM –Ω–∞ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏
- –î–æ—Ä–æ–≥–æ

**–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ (Scale Out):**
- –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —Å–µ—Ä–≤–µ—Ä–æ–≤
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ
- –î–µ—à–µ–≤–ª–µ (commodity hardware)

### 4. Idempotency

–ü—Ä–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –∑–∞–ø—Ä–æ—Å—ã –±—ã–ª–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏:
- GET /users - ‚úÖ –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ
- POST /users - ‚ö†Ô∏è –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã (–Ω—É–∂–Ω–∞ –ª–æ–≥–∏–∫–∞)
- PUT /users/123 - ‚úÖ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω

---

## üìã –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ä–µ–≤—å—é–µ—Ä–∞

### ‚úÖ –ù–∞ —Å—Ö–µ–º–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–æ:

- [x] **–ù–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** - pymongo-api-1, pymongo-api-2, pymongo-api-3 (3 —à—Ç)
- [x] **API Gateway** - nginx/Kong –Ω–∞ –ø–æ—Ä—Ç—É 80
- [x] **Consul** - Service Discovery –Ω–∞ –ø–æ—Ä—Ç—É 8500
- [x] **–°–µ—Ç–µ–≤–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ (—Å—Ç—Ä–µ–ª–∫–∏)**:
  - Client ‚Üí API Gateway (HTTP Request)
  - API Gateway ‚Üí Consul (Service Discovery)
  - API Gateway ‚Üí api-1/2/3 (Round Robin)
  - api-1/2/3 ‚Üí Consul (Register/Health Check)
  - api-1/2/3 ‚Üí Redis (Cache Check)
  - api-1/2/3 ‚Üí mongos (Query)
  - mongos ‚Üí Config Servers + Shards

---

## üîÑ –≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```
–ó–∞–¥–∞–Ω–∏–µ 1 (–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ):
üìã 3 —Å—Ö–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–ó–∞–¥–∞–Ω–∏–µ 2 (–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ):
‚öôÔ∏è 2 —à–∞—Ä–¥–∞ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

–ó–∞–¥–∞–Ω–∏–µ 3 (–†–µ–ø–ª–∏–∫–∞—Ü–∏—è):
üîÑ 3 —Ä–µ–ø–ª–∏–∫–∏ –Ω–∞ —à–∞—Ä–¥ –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

–ó–∞–¥–∞–Ω–∏–µ 4 (–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ):
üöÄ Redis –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 20-30 —Ä–∞–∑

–ó–∞–¥–∞–Ω–∏–µ 5 (API Gateway + Service Discovery):
üåê –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   3 –∏–Ω—Å—Ç–∞–Ω—Å–∞ + –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ
```

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- üé® [diagrams/ARCHITECTURE.md](../diagrams/ARCHITECTURE.md) - –°—Ö–µ–º–∞ 4 —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
- üìñ [TASK1_PLANNING.md](TASK1_PLANNING.md) - –æ–±—â–µ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- üöÄ [TASK4_SUMMARY.md](TASK4_SUMMARY.md) - –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ (–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- üè† [README.md](../README.md) - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞

---

**‚úÖ –ó–∞–¥–∞–Ω–∏–µ 5 (—Å—Ö–µ–º–∞) –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!**

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è API Gateway + Consul –≤ `compose.yaml` –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Service Discovery.

**–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –≥–æ—Ç–æ–≤–∞ –∫:**
- ‚úÖ –í—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ (—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ + –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ + –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤)
- ‚úÖ –û—Ç–∫–∞–∑–∞–º (—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è MongoDB + –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è–º –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è (rolling updates)
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é (–ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã)

**üéâ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω "–ú–æ–±–∏–ª—å–Ω—ã–π –º–∏—Ä" –≥–æ—Ç–æ–≤ –∫ "—á–µ—Ä–Ω–æ–π –ø—è—Ç–Ω–∏—Ü–µ" –∏ –ª—é–±—ã–º –Ω–∞–≥—Ä—É–∑–∫–∞–º!**

