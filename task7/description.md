### Задание 7. Проектирование схем коллекций для шардирования данных
Онлайн-магазин «Мобильный мир» сильно вырос, и теперь там можно купить не только аксессуары для смартфонов, но также электронику, аудио- и бытовую технику и другие категории товаров. Однако бэкенд сайта всё так же состоит из нескольких микросервисов.

«Мобильный мир» хранит информацию о заказах, товарах и корзинах в трёх коллекциях в MongoDB.

Коллекция orders включает заказы клиентов и содержит атрибуты:
1. Уникальный идентификатор заказа;
2. Идентификатор клиента;
3. Дату и время оформления заказа;
4. Список заказанных товаров и их цену;
5. Статус заказа;
6. Общую сумму заказа;
7. Геозону заказа.

Например, заказ пользователя из Москвы может включать товары из категорий «Электроника» и «Книги».

Основные операции:
1. Быстрое создание заказов с одновременным списанием остатков.
2. Поиск истории заказов конкретного пользователя.
3. Отображение статуса заказа.

Коллекция products хранит сведения о товарах и включает такие атрибуты:
1. Уникальный идентификатор товара;
2. Наименование;
3. Категорию товара;
4. Цену;
5. Остаток товара в каждой геозоне;
6. Дополнительные атрибуты (цвет, размер).

Например, в Екатеринбурге есть в наличии 50 штук товара «Смартфон X», а в Калининграде — 30.

Основные операции:
1. Частые обновления остатков при покупках.
2. Поиск товаров по категориям и фильтрация по диапазону цен.
3. Описание товара на странице продукта.

Коллекция carts хранит данные о текущих корзинах (как гостевых, так и пользовательских) и включает атрибуты:
1. Уникальный идентификатор корзины (_id);
2. Идентификатор пользователя (user_id) и session_id для гостей;
3. Список товаров (items): массив документов { product_id, quantity };
4. Статус корзины (status): "active" | "ordered" | "abandoned";
5. Дату и время создания (created_at);
6. Дату и время последнего обновления (updated_at);
7. Время удаления (TTL) (expires_at) — для автоматической очистки старых корзин.

Основные операции:
1. Создание корзины, когда заходит гость или новый пользователь.
2. Получение текущей корзины по фильтру { session_id, status:"active" } или { user_id, status:"active" }.
3. Добавление или замена товара в корзине.
4. Удаление товара из корзины.
5. Слияние гостевой корзины в пользовательскую, если пользователь залогинится:
* прочитать гостевую { session_id, status:"active" };
* добавить её items в корзину { user_id, status:"active" };
* отметить гостевую как abandoned.
6. Отметка корзины как заказанной.

### Что нужно сделать:
1. Спроектируйте схемы коллекций products, orders и carts. Проанализируйте представленные атрибуты коллекций и выберите потенциальных кандидатов для шард-ключей.
2. Выберите стратегию шардирования для каждой коллекции, которая обеспечит эффективное распределение данных по шардам.
3. Укажите, почему выбранная стратегия и шард-ключ подходят под особенности коллекций и операций.

### На что будет смотреть ревьюер:
Архитектурный документ с описанием, схемами коллекций и примерами команд MongoDB.
