### <a name="_b7urdng99y53"></a>**Название задачи: Task 8. Перегрузка шарда**  

### <a name="_3bfxc9a45514"></a>**Описание проблемы**  
Для коллекций products и orders и carts определите:
Какие операции чтения могут использовать secondary реплику для чтения.
Какие операции чтения должны читать только с primary.
Укажите, какая задержка репликации допустима для операций на secondary.
Обоснуйте выбор, опираясь на:
Требования к консистентности данных.
Частоту обновлений.
Бизнес-логику (например, риск продажи недоступного товара или отображение устаревшего статуса заказа пользователю).

-----
### <a name="_qmphm5d6rvi3"></a>**Решение**  
#### Распределение операций чтения
Коллекция orders
| Операция                   | Направление | Комментарий                                                                                                                                                                                                                                                                                                                                                                                                                                           | Допустимая задержка репликации |
|----------------------------|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
| Просмотр истории заказов   | secondary   | Историю заказов часто просматривают сильно позже момента создания нового заказа, к такой функциональности нет требований строгой консистентности.                                                                                                                                                                                                                                                                                                     | 1 мин                          |
| Отображение статуса заказа | secondary   | При допущении, что магазин электроники поддерживает не очень подробную статусную модель и обрабатывает заказы не моментально, можно допустить не строгую консистентность с небольшой задержкой. С помощью UI можно управлять опытом пользователя при подгрузке первичного статуса (если пользователь создал заказ, и сразу обновил страницу, но данных в реплике еще нет, можно отобразить UI Loader или статус "Обработка" до момента синхронизации) | 10 сек                         |



Коллекция products
| Операция                                                                                | Направление | Комментарий                                                                                                                                                                                  | Допустимая задержка репликации                                                                                                                    |
|-----------------------------------------------------------------------------------------|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| Поиск, просмотр каталога                                                                | secondary   | Товары редко меняются, поэтому строгая консистентность не обязательна и задержка допустима с принятием риска продажи по неактуальной цене.                                                   | Задержка репликации должна быть расчитана исходя из потерь из-за продаж не актуальных товаров. Без финансовых данных предположим задержку 1-5 мин |
| Получение остатков                                                                      | primary     | При получении остатков важно показать наиболее актуальную информацию и при выполнении запроса для пользователя (отображение доступного количества) и (тем более) при проверке внутри системы |                                                                                                                                                   |
| Просмотр карточки товара (считая, что данные о наличии подтягиваются запросом остатков) | secondary   | Товары редко меняются, поэтому строгая консистентность не обязательна и задержка допустима                                                                                                   | -                                                                                                                                                 |
| Поиск товаров в наличии                                                                 | primary     | Для обеспечения качественного пользовательского опыта желательно опираться на максимально актуальную информацию.                                                                             | -                                                                                                                                                 |


Коллекция carts
| Операция                   | Направление | Комментарий                                                                                                                    | Допустимая задержка репликации |
|----------------------------|-------------|--------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
| Получение активной корзины | primary     | Для качественного пользовательского опыта при работе с разных устройств желательна максимальная актуальность состояния корзины | -                              |
