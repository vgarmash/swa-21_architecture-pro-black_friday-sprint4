# –î–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã MongoDB Sharding Optimization

> üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏  
> üè† [‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ README](../README.md) | üìä [–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∏–∞–≥—Ä–∞–º–º ‚Üí](ARCHITECTURE.md) | üìñ [–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí](../PLANNING.md)

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Mermaid.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

### –ò—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã (Mermaid)
- `01-sharding.mmd` - –°—Ö–µ–º–∞ 1: –ë–∞–∑–æ–≤–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å 2 —à–∞—Ä–¥–∞–º–∏
- `02-sharding-replication.mmd` - –°—Ö–µ–º–∞ 2: –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ + –†–µ–ø–ª–∏–∫–∞—Ü–∏—è (–ø–æ 3 —Ä–µ–ø–ª–∏–∫–∏ –Ω–∞ —à–∞—Ä–¥)
- `03-sharding-replication-caching.mmd` - –°—Ö–µ–º–∞ 3: –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ + –†–µ–ø–ª–∏–∫–∞—Ü–∏—è + Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã
–ü–∞–ø–∫–∞ `output/` —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
- PNG —Ñ–∞–π–ª—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- SVG —Ñ–∞–π–ª—ã –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

–î–∏–∞–≥—Ä–∞–º–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ GitHub Actions –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `.mmd` —Ñ–∞–π–ª–æ–≤ –≤ –≤–µ—Ç–∫–∞—Ö `main` –∏–ª–∏ `solution`.

### –õ–æ–∫–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Mermaid CLI:

```bash
npm install -g @mermaid-js/mermaid-cli
```

–ó–∞—Ç–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:

```bash
# PNG
mmdc -i diagrams/01-sharding.mmd -o diagrams/output/01-sharding.png -b transparent -t dark -p puppeteer-config.json

# SVG
mmdc -i diagrams/01-sharding.mmd -o diagrams/output/01-sharding.svg -b transparent -t dark -p puppeteer-config.json
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö –¥–∏–∞–≥—Ä–∞–º–º:

```bash
./scripts/generate-diagrams.sh
```

## –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ö–µ–º

### –°—Ö–µ–º–∞ 1: –ë–∞–∑–æ–≤–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≤–∫–ª—é—á–∞–µ—Ç:
- 1 –∏–Ω—Å—Ç–∞–Ω—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (pymongo-api)
- 1 mongos —Ä–æ—É—Ç–µ—Ä
- 3 –∫–æ–Ω—Ñ–∏–≥-—Å–µ—Ä–≤–µ—Ä–∞ (configSrv1, configSrv2, configSrv3)
- 2 —à–∞—Ä–¥–∞ (shard1, shard2)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É —à–∞—Ä–¥–∞–º–∏
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –°—Ö–µ–º–∞ 2: –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ + –†–µ–ø–ª–∏–∫–∞—Ü–∏—è
–í—Ç–æ—Ä–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:
- –ö–æ–Ω—Ñ–∏–≥-—Å–µ—Ä–≤–µ—Ä—ã –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ replica set
- –ö–∞–∂–¥—ã–π —à–∞—Ä–¥ —Å—Ç–∞–ª replica set —Å 3 —Ä–µ–ø–ª–∏–∫–∞–º–∏:
  - Shard 1: shard1-1 (Primary), shard1-2 (Secondary), shard1-3 (Secondary)
  - Shard 2: shard2-1 (Primary), shard2-2 (Secondary), shard2-3 (Secondary)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å (–ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –æ–¥–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (automatic failover)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è —Å secondary –Ω–æ–¥ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è read –Ω–∞–≥—Ä—É–∑–∫–∏

### –°—Ö–µ–º–∞ 3: –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ + –†–µ–ø–ª–∏–∫–∞—Ü–∏—è + –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
–§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:
- –ò–Ω—Å—Ç–∞–Ω—Å Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–µ—à –ø–µ—Ä–µ–¥ –æ–±—Ä–∞—â–µ–Ω–∏–µ–º –∫ MongoDB

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ MongoDB
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

## –õ–µ–≥–µ–Ω–¥–∞

- **–°–ø–ª–æ—à–Ω—ã–µ —Å—Ç—Ä–µ–ª–∫–∏** (‚Üí) - –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- **–ü—É–Ω–∫—Ç–∏—Ä–Ω—ã–µ —Å—Ç—Ä–µ–ª–∫–∏** (-.->)  - —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–∏ replica set
- **–¶–≤–µ—Ç–∞**:
  - –ó–µ–ª–µ–Ω—ã–π - Application Layer (API)
  - –ö—Ä–∞—Å–Ω—ã–π - Caching Layer (Redis)
  - –û—Ä–∞–Ω–∂–µ–≤—ã–π - Query Router (mongos)
  - –°–∏–Ω–∏–π - Config Servers
  - –§–∏–æ–ª–µ—Ç–æ–≤—ã–π/–†–æ–∑–æ–≤—ã–π - Data Shards

