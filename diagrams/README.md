# Диаграммы архитектуры MongoDB Sharding Optimization

Этот каталог содержит диаграммы архитектуры проекта в формате Mermaid.

## Структура

### Исходные файлы (Mermaid)
- `01-sharding.mmd` - Схема 1: Базовое шардирование с 2 шардами
- `02-sharding-replication.mmd` - Схема 2: Шардирование + Репликация (по 3 реплики на шард)
- `03-sharding-replication-caching.mmd` - Схема 3: Шардирование + Репликация + Redis кеширование

### Скомпилированные диаграммы
Папка `output/` содержит автоматически сгенерированные изображения:
- PNG файлы для использования в документации
- SVG файлы для масштабируемых векторных изображений

## Автоматическая генерация

Диаграммы автоматически компилируются при помощи GitHub Actions при любом изменении `.mmd` файлов в ветках `main` или `solution`.

### Локальная генерация

Для локальной генерации диаграмм установите Mermaid CLI:

```bash
npm install -g @mermaid-js/mermaid-cli
```

Затем сгенерируйте изображения:

```bash
# PNG
mmdc -i diagrams/01-sharding.mmd -o diagrams/output/01-sharding.png -b transparent -t dark

# SVG
mmdc -i diagrams/01-sharding.mmd -o diagrams/output/01-sharding.svg -b transparent -t dark
```

Или используйте скрипт для генерации всех диаграмм:

```bash
./scripts/generate-diagrams.sh
```

## Описание схем

### Схема 1: Базовое шардирование
Первая версия архитектуры включает:
- 1 инстанс приложения (pymongo-api)
- 1 mongos роутер
- 3 конфиг-сервера (configSrv1, configSrv2, configSrv3)
- 2 шарда (shard1, shard2)

**Преимущества:**
- Горизонтальное масштабирование данных
- Распределение нагрузки между шардами
- Увеличение пропускной способности

### Схема 2: Шардирование + Репликация
Вторая версия добавляет отказоустойчивость:
- Конфиг-серверы объединены в replica set
- Каждый шард стал replica set с 3 репликами:
  - Shard 1: shard1-1 (Primary), shard1-2 (Secondary), shard1-3 (Secondary)
  - Shard 2: shard2-1 (Primary), shard2-2 (Secondary), shard2-3 (Secondary)

**Преимущества:**
- Отказоустойчивость (при падении одной реплики кластер продолжает работу)
- Автоматическое восстановление (automatic failover)
- Возможность чтения с secondary нод для распределения read нагрузки

### Схема 3: Шардирование + Репликация + Кеширование
Финальная версия добавляет Redis для кеширования:
- Инстанс Redis для кеширования частых запросов
- Приложение сначала проверяет кеш перед обращением к MongoDB

**Преимущества:**
- Снижение нагрузки на MongoDB
- Ускорение ответов для частых запросов
- Дополнительное повышение производительности при высокой нагрузке

## Легенда

- **Сплошные стрелки** (→) - основные сетевые взаимодействия
- **Пунктирные стрелки** (-.->)  - репликация данных внутри replica set
- **Цвета**:
  - Зеленый - Application Layer (API)
  - Красный - Caching Layer (Redis)
  - Оранжевый - Query Router (mongos)
  - Синий - Config Servers
  - Фиолетовый/Розовый - Data Shards

